"use strict";angular.module("gmitcat",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.sortable","LocalStorageModule","720kb.datepicker"]).config(["$routeProvider",function(a){a.when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",controllerAs:"home"}).when("/notify",{templateUrl:"views/notify.html",controller:"NotifyCtrl",controllerAs:"notify"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"login"}).otherwise({redirectTo:"/home"})}]).run(["$rootScope","$location","auth",function(a,b,c){a.$on("$routeChangeStart",function(a){c.isLoggedIn()?b.path(b.$$path):b.path("/login")})}]),angular.module("gmitcat").controller("MainCtrl",["$scope","auth","$location",function(a,b,c){a.$watch(b.isLoggedIn,function(a,b){!a&&b&&(console.log("Disconnect"),c.path("/login")),a&&console.log("Connect")},!0)}]),angular.module("gmitcat").controller("NotifyCtrl",["$http","userService","$timeout","$interval","messageService","$filter","$rootScope","detailsService",function(a,b,c,d,e,f,g,h){function i(){m.messages=e.messages}function j(){if(void 0!=m.messages&&m.messages.length>0){var a=0;m.messages.forEach(function(b){"queued"==b.result&&l(b,a),a++},this),c(function(){m.messages=e.getMessages()},5e3)}}function k(d){m.notifyWarning=!0;var f=h.appDetails.privateKey,g=b.deviceTokens,i=h.appDetails.appId,j=btoa(f+":"),k={method:"POST",url:"https://push.ionic.io/api/v1/push",headers:{"Content-Type":"application/json","X-Ionic-Application-Id":i,Authorization:"basic "+j},data:{tokens:g,notification:{alert:d.message}}};a(k).success(function(a){a.message=k.data.notification.alert,a.tokens=k.data.tokens,a.timeStamp=Date.now(),a._id=Date.now().toString(),e.saveMessage(a),m.messages=e.getMessages(),m.notifyWarning=!1,m.notifySuccess=!0,m.messages=e.messages,c(function(){m.notifySuccess=!1,m.messages=e.messages},3e3)}).error(function(a){console.log("error: "+JSON.stringify(a)),console.log("Ionic Push: Push error..."),m.notifyWarning=!1,m.notifyError=!0,c(function(){m.notifyError=!1},3e3)})}function l(b,c){var d=h.appDetails.privateKey,f=h.appDetails.appId,g=b.message_id,i=btoa(d+":"),j={method:"GET",url:"https://push.ionic.io/api/v1/status/"+g,headers:{"Content-Type":"application/json","X-Ionic-Application-Id":f,Authorization:"basic "+i}};a(j).success(function(a){m.messages[c].result=a.status,e.saveMessage(m.messages[c]),m.messages=e.getMessages()}).error(function(a){console.log("Ionic Push: Push error..."),console.log("error: "+JSON.stringify(a))})}var m=this;m.notifySuccess=!1,m.notifyError=!1,m.notifyWarning=!1,m.sendPush=k,m.messages=e.messages,m.refreshMessages=i,c(function(){m.refreshMessages(),m.userCount=b.deviceTokens.length},250),c(function(){m.refreshMessages(),m.userCount=b.deviceTokens.length},500),c(function(){m.refreshMessages(),m.userCount=b.deviceTokens.length},1e3),c(function(){j()},1e3);var n;n=d(function(){j(),m.userCount=b.deviceTokens.length,m.refreshMessages(),c(function(){g.$apply()})},1e4)}]),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.PouchDB=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){return function(){var b=arguments.length;if(b){for(var c=[],d=-1;++d<b;)c[d]=arguments[d];return a.call(this,c)}return a.call(this,[])}}b.exports=d},{}],2:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?c.storage.removeItem("debug"):c.storage.debug=a}catch(b){}}function h(){var a;try{a=c.storage.debug}catch(b){}return a}function i(){try{return window.localStorage}catch(a){}}c=b.exports=a(3),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:i(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{3:3}],3:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;d>e;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;d>b;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;d>b;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a(9),c.names=[],c.skips=[],c.formatters={};var j,k=0},{9:9}],4:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],5:[function(a,b,c){(function(a){function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||"undefined"==typeof a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],7:[function(a,b,c){(function(a){a("object"==typeof c?c:this)}).call(this,function(a){var b=Array.prototype.slice,c=Array.prototype.forEach,d=function(a){if("object"!=typeof a)throw a+" is not an object";var e=b.call(arguments,1);return c.call(e,function(b){if(b)for(var c in b)"object"==typeof b[c]&&a[c]?d.call(a,a[c],b[c]):a[c]=b[c]}),a};a.extend=d})},{}],8:[function(a,b,c){function d(){}function e(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(e){return p.reject(a,e)}d===a?p.reject(a,new TypeError("Cannot resolve promise with itself")):p.resolve(a,d)})}function h(a){var b=a&&a.then;return a&&"object"==typeof a&&"function"==typeof b?function(){b.apply(a,arguments)}:void 0}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);"error"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status="success"}catch(d){c.status="error",c.value=d}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a(5),p={},q=["REJECTED"],r=["FULFILLED"],s=["PENDING"];b.exports=c=e,e.prototype["catch"]=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if("function"!=typeof a&&this.state===r||"function"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){var e=this.state===r?a:b;g(c,e,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if("error"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},c.resolve=k,c.reject=l,c.all=m,c.race=n},{5:5}],9:[function(a,b,c){function d(a){if(a=""+a,!(a.length>1e4)){var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"hrs":case"hr":case"h":return c*j;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c}}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){return b>a?void 0:1.5*b>a?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b["long"]?f(a):e(a)}},{}],10:[function(a,b,c){function d(a){if(null!==a)switch(typeof a){case"boolean":return a?1:0;case"number":return k(a);case"string":return a.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var b=Array.isArray(a),d=b?a:Object.keys(a),e=-1,f=d.length,g="";if(b)for(;++e<f;)g+=c.toIndexableString(d[e]);else for(;++e<f;){var h=d[e];g+=c.toIndexableString(h)+c.toIndexableString(a[h])}return g}return""}function e(a,b){var c,d=b,e="1"===a[b];if(e)c=0,b++;else{var f="0"===a[b];b++;var g="",h=a.substring(b,b+m),i=parseInt(h,10)+l;for(f&&(i=-i),b+=m;;){var j=a[b];if("\x00"===j)break;g+=j,b++}g=g.split("."),c=1===g.length?parseInt(g,10):parseFloat(g[0]+"."+g[1]),f&&(c-=10),0!==i&&(c=parseFloat(c+"e"+i))}return{num:c,length:b-d}}function f(a,b){var c=a.pop();if(b.length){var d=b[b.length-1];c===d.element&&(b.pop(),d=b[b.length-1]);var e=d.element,f=d.index;if(Array.isArray(e))e.push(c);else if(f===a.length-2){var g=a.pop();e[g]=c}else a.push(c)}}function g(a,b){for(var d=Math.min(a.length,b.length),e=0;d>e;e++){var f=c.collate(a[e],b[e]);if(0!==f)return f}return a.length===b.length?0:a.length>b.length?1:-1}function h(a,b){return a===b?0:a>b?1:-1}function i(a,b){for(var d=Object.keys(a),e=Object.keys(b),f=Math.min(d.length,e.length),g=0;f>g;g++){var h=c.collate(d[g],e[g]);if(0!==h)return h;if(h=c.collate(a[d[g]],b[e[g]]),0!==h)return h}return d.length===e.length?0:d.length>e.length?1:-1}function j(a){var b=["boolean","number","string","object"],c=b.indexOf(typeof a);return~c?null===a?1:Array.isArray(a)?5:3>c?c+2:c+3:Array.isArray(a)?5:void 0}function k(a){if(0===a)return"1";var b=a.toExponential().split(/e\+?/),c=parseInt(b[1],10),d=0>a,e=d?"0":"2",f=(d?-c:c)-l,g=o.padLeft(f.toString(),"0",m);e+=n+g;var h=Math.abs(parseFloat(b[0]));d&&(h=10-h);var i=h.toFixed(20);return i=i.replace(/\.?0+$/,""),e+=n+i}var l=-324,m=3,n="",o=a(11);c.collate=function(a,b){if(a===b)return 0;a=c.normalizeKey(a),b=c.normalizeKey(b);var d=j(a),e=j(b);if(d-e!==0)return d-e;if(null===a)return 0;switch(typeof a){case"number":return a-b;case"boolean":return a===b?0:b>a?-1:1;case"string":return h(a,b)}return Array.isArray(a)?g(a,b):i(a,b)},c.normalizeKey=function(a){switch(typeof a){case"undefined":return null;case"number":return a===1/0||a===-(1/0)||isNaN(a)?null:a;case"object":var b=a;if(Array.isArray(a)){var d=a.length;a=new Array(d);for(var e=0;d>e;e++)a[e]=c.normalizeKey(b[e])}else{if(a instanceof Date)return a.toJSON();if(null!==a){a={};for(var f in b)if(b.hasOwnProperty(f)){var g=b[f];"undefined"!=typeof g&&(a[f]=c.normalizeKey(g))}}}}return a},c.toIndexableString=function(a){var b="\x00";return a=c.normalizeKey(a),j(a)+n+d(a)+b},c.parseIndexableString=function(a){for(var b=[],c=[],d=0;;){var g=a[d++];if("\x00"!==g)switch(g){case"1":b.push(null);break;case"2":b.push("1"===a[d]),d++;break;case"3":var h=e(a,d);b.push(h.num),d+=h.length;break;case"4":for(var i="";;){var j=a[d];if("\x00"===j)break;i+=j,d++}i=i.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),b.push(i);break;case"5":var k={element:[],index:b.length};b.push(k.element),c.push(k);break;case"6":var l={element:{},index:b.length};b.push(l.element),c.push(l);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+g)}else{if(1===b.length)return b.pop();f(b,c)}}}},{11:11}],11:[function(a,b,c){function d(a,b,c){for(var d="",e=c-a.length;d.length<e;)d+=b;return d}c.padLeft=function(a,b,c){var e=d(a,b,c);return e+a},c.padRight=function(a,b,c){var e=d(a,b,c);return a+e},c.stringLexCompare=function(a,b){var c,d=a.length,e=b.length;for(c=0;d>c;c++){if(c===e)return 1;var f=a.charAt(c),g=b.charAt(c);if(f!==g)return g>f?-1:1}return e>d?-1:0},c.intToDecimalForm=function(a){var b=0>a,c="";do{var d=b?-Math.ceil(a%10):Math.floor(a%10);c=d+c,a=b?Math.ceil(a/10):Math.floor(a/10)}while(a);return b&&"0"!==c&&(c="-"+c),c}},{}],12:[function(a,b,c){function d(){this.store={}}function e(a){if(this.store=new d,a&&Array.isArray(a))for(var b=0,c=a.length;c>b;b++)this.add(a[b])}c.Map=d,c.Set=e,d.prototype.mangle=function(a){if("string"!=typeof a)throw new TypeError("key must be a string but Got "+a);return"$"+a},d.prototype.unmangle=function(a){return a.substring(1)},d.prototype.get=function(a){var b=this.mangle(a);return b in this.store?this.store[b]:void 0},d.prototype.set=function(a,b){var c=this.mangle(a);return this.store[c]=b,!0},d.prototype.has=function(a){var b=this.mangle(a);return b in this.store},d.prototype["delete"]=function(a){var b=this.mangle(a);return b in this.store?(delete this.store[b],!0):!1},d.prototype.forEach=function(a){for(var b=Object.keys(this.store),c=0,d=b.length;d>c;c++){var e=b[c],f=this.store[e];e=this.unmangle(e),a(f,e)}},e.prototype.add=function(a){return this.store.set(a,!0)},e.prototype.has=function(a){return this.store.has(a)},e.prototype["delete"]=function(a){return this.store["delete"](a)}},{}],13:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h&&h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],14:[function(a,b,c){(function(){var a={}.hasOwnProperty,c=[].slice;b.exports=function(b,d){var e,f,g,h;f=[],h=[];for(e in d)a.call(d,e)&&(g=d[e],"this"!==e&&(f.push(e),h.push(g)));return Function.apply(null,c.call(f).concat([b])).apply(d["this"],h)}}).call(this)},{}],15:[function(b,c,d){!function(b){if("object"==typeof d)c.exports=b();else if("function"==typeof a&&a.amd)a(b);else{var e;try{e=window}catch(f){e=self}e.SparkMD5=b()}}(function(a){function b(a,b,c,d,e,f){return b=t(t(b,a),t(d,f)),t(b<<e|b>>>32-e,c)}function c(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)}function d(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)}function e(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)}function f(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)}function g(a,b){var g=a[0],h=a[1],i=a[2],j=a[3];g=c(g,h,i,j,b[0],7,-680876936),j=c(j,g,h,i,b[1],12,-389564586),i=c(i,j,g,h,b[2],17,606105819),h=c(h,i,j,g,b[3],22,-1044525330),g=c(g,h,i,j,b[4],7,-176418897),j=c(j,g,h,i,b[5],12,1200080426),i=c(i,j,g,h,b[6],17,-1473231341),h=c(h,i,j,g,b[7],22,-45705983),g=c(g,h,i,j,b[8],7,1770035416),j=c(j,g,h,i,b[9],12,-1958414417),i=c(i,j,g,h,b[10],17,-42063),h=c(h,i,j,g,b[11],22,-1990404162),g=c(g,h,i,j,b[12],7,1804603682),j=c(j,g,h,i,b[13],12,-40341101),i=c(i,j,g,h,b[14],17,-1502002290),h=c(h,i,j,g,b[15],22,1236535329),g=d(g,h,i,j,b[1],5,-165796510),j=d(j,g,h,i,b[6],9,-1069501632),i=d(i,j,g,h,b[11],14,643717713),h=d(h,i,j,g,b[0],20,-373897302),g=d(g,h,i,j,b[5],5,-701558691),j=d(j,g,h,i,b[10],9,38016083),i=d(i,j,g,h,b[15],14,-660478335),h=d(h,i,j,g,b[4],20,-405537848),g=d(g,h,i,j,b[9],5,568446438),j=d(j,g,h,i,b[14],9,-1019803690),i=d(i,j,g,h,b[3],14,-187363961),h=d(h,i,j,g,b[8],20,1163531501),g=d(g,h,i,j,b[13],5,-1444681467),j=d(j,g,h,i,b[2],9,-51403784),i=d(i,j,g,h,b[7],14,1735328473),h=d(h,i,j,g,b[12],20,-1926607734),g=e(g,h,i,j,b[5],4,-378558),j=e(j,g,h,i,b[8],11,-2022574463),i=e(i,j,g,h,b[11],16,1839030562),h=e(h,i,j,g,b[14],23,-35309556),g=e(g,h,i,j,b[1],4,-1530992060),j=e(j,g,h,i,b[4],11,1272893353),i=e(i,j,g,h,b[7],16,-155497632),h=e(h,i,j,g,b[10],23,-1094730640),g=e(g,h,i,j,b[13],4,681279174),j=e(j,g,h,i,b[0],11,-358537222),i=e(i,j,g,h,b[3],16,-722521979),h=e(h,i,j,g,b[6],23,76029189),g=e(g,h,i,j,b[9],4,-640364487),j=e(j,g,h,i,b[12],11,-421815835),i=e(i,j,g,h,b[15],16,530742520),h=e(h,i,j,g,b[2],23,-995338651),g=f(g,h,i,j,b[0],6,-198630844),j=f(j,g,h,i,b[7],10,1126891415),i=f(i,j,g,h,b[14],15,-1416354905),h=f(h,i,j,g,b[5],21,-57434055),g=f(g,h,i,j,b[12],6,1700485571),j=f(j,g,h,i,b[3],10,-1894986606),i=f(i,j,g,h,b[10],15,-1051523),h=f(h,i,j,g,b[1],21,-2054922799),g=f(g,h,i,j,b[8],6,1873313359),j=f(j,g,h,i,b[15],10,-30611744),i=f(i,j,g,h,b[6],15,-1560198380),h=f(h,i,j,g,b[13],21,1309151649),g=f(g,h,i,j,b[4],6,-145523070),j=f(j,g,h,i,b[11],10,-1120210379),i=f(i,j,g,h,b[2],15,718787259),h=f(h,i,j,g,b[9],21,-343485551),a[0]=t(g,a[0]),a[1]=t(h,a[1]),a[2]=t(i,a[2]),a[3]=t(j,a[3])}function h(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c}function i(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c}function j(a){var b,c,d,e,f,i,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)g(k,h(a.substring(b-64,b)));for(a=a.substring(b-64),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a.charCodeAt(b)<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(g(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),i=parseInt(e[1],16)||0,d[14]=f,d[15]=i,g(k,d),k}function k(a){var b,c,d,e,f,h,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)g(k,i(a.subarray(b-64,b)));for(a=j>b-64?a.subarray(b-64):new Uint8Array(0),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a[b]<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(g(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),h=parseInt(e[1],16)||0,d[14]=f,d[15]=h,g(k,d),k}function l(a){var b,c="";for(b=0;4>b;b+=1)c+=u[a>>8*b+4&15]+u[a>>8*b&15];return c}function m(a){var b;for(b=0;b<a.length;b+=1)a[b]=l(a[b]);return a.join("")}function n(a){return/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a))),a}function o(a,b){var c,d=a.length,e=new ArrayBuffer(d),f=new Uint8Array(e);for(c=0;d>c;c+=1)f[c]=a.charCodeAt(c);return b?f:e}function p(a){return String.fromCharCode.apply(null,new Uint8Array(a))}function q(a,b,c){var d=new Uint8Array(a.byteLength+b.byteLength);return d.set(new Uint8Array(a)),d.set(new Uint8Array(b),a.byteLength),c?d:d.buffer}function r(a){var b,c=[],d=a.length;for(b=0;d-1>b;b+=2)c.push(parseInt(a.substr(b,2),16));return String.fromCharCode.apply(String,c)}function s(){this.reset()}var t=function(a,b){return a+b&4294967295},u=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==m(j("hello"))&&(t=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function b(a,b){return a=0|a||0,0>a?Math.max(a+b,0):Math.min(a,b)}ArrayBuffer.prototype.slice=function(c,d){var e,f,g,h,i=this.byteLength,j=b(c,i),k=i;return d!==a&&(k=b(d,i)),j>k?new ArrayBuffer(0):(e=k-j,f=new ArrayBuffer(e),g=new Uint8Array(f),h=new Uint8Array(this,j,e),g.set(h),f)}}(),s.prototype.append=function(a){return this.appendBinary(n(a)),this},s.prototype.appendBinary=function(a){this._buff+=a,this._length+=a.length;var b,c=this._buff.length;for(b=64;c>=b;b+=64)g(this._hash,h(this._buff.substring(b-64,b)));return this._buff=this._buff.substring(b-64),this},s.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;e>b;b+=1)f[b>>2]|=d.charCodeAt(b)<<(b%4<<3);return this._finish(f,e),c=m(this._hash),a&&(c=r(c)),this.reset(),c},s.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},s.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},s.prototype.setState=function(a){return this._buff=a.buff,this._length=a.length,this._hash=a.hash,this},s.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},s.prototype._finish=function(a,b){var c,d,e,f=b;if(a[f>>2]|=128<<(f%4<<3),f>55)for(g(this._hash,a),f=0;16>f;f+=1)a[f]=0;c=8*this._length,c=c.toString(16).match(/(.*?)(.{0,8})$/),d=parseInt(c[2],16),e=parseInt(c[1],16)||0,a[14]=d,a[15]=e,g(this._hash,a)},s.hash=function(a,b){return s.hashBinary(n(a),b)},s.hashBinary=function(a,b){var c=j(a),d=m(c);return b?r(d):d},s.ArrayBuffer=function(){this.reset()},s.ArrayBuffer.prototype.append=function(a){var b,c=q(this._buff.buffer,a,!0),d=c.length;for(this._length+=a.byteLength,b=64;d>=b;b+=64)g(this._hash,i(c.subarray(b-64,b)));return this._buff=d>b-64?new Uint8Array(c.buffer.slice(b-64)):new Uint8Array(0),this},s.ArrayBuffer.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;e>b;b+=1)f[b>>2]|=d[b]<<(b%4<<3);return this._finish(f,e),c=m(this._hash),a&&(c=r(c)),this.reset(),c},s.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},s.ArrayBuffer.prototype.getState=function(){var a=s.prototype.getState.call(this);return a.buff=p(a.buff),a},s.ArrayBuffer.prototype.setState=function(a){return a.buff=o(a.buff,!0),s.prototype.setState.call(this,a)},s.ArrayBuffer.prototype.destroy=s.prototype.destroy,s.ArrayBuffer.prototype._finish=s.prototype._finish,s.ArrayBuffer.hash=function(a,b){var c=k(new Uint8Array(a)),d=m(c);return b?r(d):d},s})},{}],16:[function(a,b,c){function d(a,b,c){var d=c[c.length-1];a===d.element&&(c.pop(),d=c[c.length-1]);var e=d.element,f=d.index;if(Array.isArray(e))e.push(a);else if(f===b.length-2){var g=b.pop();e[g]=a}else b.push(a)}c.stringify=function(a){var b=[];b.push({obj:a});for(var c,d,e,f,g,h,i,j,k,l,m,n="";c=b.pop();)if(d=c.obj,e=c.prefix||"",f=c.val||"",n+=e,f)n+=f;else if("object"!=typeof d)n+="undefined"==typeof d?null:JSON.stringify(d);else if(null===d)n+="null";else if(Array.isArray(d)){for(b.push({val:"]"}),g=d.length-1;g>=0;g--)h=0===g?"":",",b.push({obj:d[g],prefix:h});b.push({val:"["})}else{i=[];for(j in d)d.hasOwnProperty(j)&&i.push(j);for(b.push({val:"}"}),g=i.length-1;g>=0;g--)k=i[g],l=d[k],m=g>0?",":"",m+=JSON.stringify(k)+":",b.push({obj:l,prefix:m});b.push({val:"{"})}return n},c.parse=function(a){for(var b,c,e,f,g,h,i,j,k,l=[],m=[],n=0;;)if(b=a[n++],"}"!==b&&"]"!==b&&"undefined"!=typeof b)switch(b){case" ":case"	":case"\n":case":":case",":break;case"n":n+=3,d(null,l,m);break;case"t":n+=3,d(!0,l,m);break;case"f":n+=4,d(!1,l,m);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(c="",n--;;){if(e=a[n++],!/[\d\.\-e\+]/.test(e)){n--;break}c+=e}d(parseFloat(c),l,m);break;case'"':for(f="",g=void 0,h=0;i=a[n++],'"'!==i||"\\"===g&&h%2===1;)f+=i,g=i,"\\"===g?h++:h=0;d(JSON.parse('"'+f+'"'),l,m);break;case"[":j={element:[],index:l.length},l.push(j.element),m.push(j);break;case"{":k={element:{},index:l.length},l.push(k.element),m.push(k);break;default:throw new Error("unexpectedly reached end of input: "+b)}else{if(1===l.length)return l.pop();d(l.pop(),l,m)}}},{}],17:[function(a,b,c){(function(c,d){function e(a,b){a=a||[],b=b||{};try{return new Blob(a,b)}catch(c){if("TypeError"!==c.name)throw c;for(var d="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,e=new d,f=0;f<a.length;f+=1)e.append(a[f]);return e.getBlob(b.type)}}function f(a,b){if("undefined"==typeof FileReader)return b((new FileReaderSync).readAsArrayBuffer(a));var c=new FileReader;c.onloadend=function(a){var c=a.target.result||new ArrayBuffer(0);b(c)},c.readAsArrayBuffer(a)}function g(){for(var a={},b=new dd(function(b,c){a.resolve=b,a.reject=c}),c=new Array(arguments.length),d=0;d<c.length;d++)c[d]=arguments[d];return a.promise=b,dd.resolve().then(function(){return fetch.apply(null,c)}).then(function(b){a.resolve(b)})["catch"](function(b){a.reject(b)}),a}function h(a,b){var c,d,e,h=new Headers,i={method:a.method,credentials:"include",headers:h};return a.json&&(h.set("Accept","application/json"),h.set("Content-Type",a.headers["Content-Type"]||"application/json")),a.body&&a.body instanceof Blob?f(a.body,function(a){i.body=a;
}):a.body&&a.processData&&"string"!=typeof a.body?i.body=JSON.stringify(a.body):"body"in a?i.body=a.body:i.body=null,Object.keys(a.headers).forEach(function(b){a.headers.hasOwnProperty(b)&&h.set(b,a.headers[b])}),c=g(a.url,i),a.timeout>0&&(d=setTimeout(function(){c.reject(new Error("Load timeout for resource: "+a.url))},a.timeout)),c.promise.then(function(b){return e={statusCode:b.status},a.timeout>0&&clearTimeout(d),e.statusCode>=200&&e.statusCode<300?a.binary?b.blob():b.text():b.json()}).then(function(a){e.statusCode>=200&&e.statusCode<300?b(null,e,a):b(a,e)})["catch"](function(a){b(a,e)}),{abort:c.reject}}function i(a,b){var c,d,g=function(){c.abort()};c=a.xhr?new a.xhr:new XMLHttpRequest;try{c.open(a.method,a.url)}catch(h){b(h,{statusCode:413})}c.withCredentials="withCredentials"in a?a.withCredentials:!0,"GET"===a.method?delete a.headers["Content-Type"]:a.json&&(a.headers.Accept="application/json",a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json",a.body&&a.processData&&"string"!=typeof a.body&&(a.body=JSON.stringify(a.body))),a.binary&&(c.responseType="arraybuffer"),"body"in a||(a.body=null);for(var i in a.headers)a.headers.hasOwnProperty(i)&&c.setRequestHeader(i,a.headers[i]);return a.timeout>0&&(d=setTimeout(g,a.timeout),c.onprogress=function(){clearTimeout(d),d=setTimeout(g,a.timeout)},"undefined"!=typeof c.upload&&(c.upload.onprogress=c.onprogress)),c.onreadystatechange=function(){if(4===c.readyState){var d={statusCode:c.status};if(c.status>=200&&c.status<300){var f;f=a.binary?e([c.response||""],{type:c.getResponseHeader("Content-Type")}):c.responseText,b(null,d,f)}else{var g={};try{g=JSON.parse(c.response)}catch(h){}b(g,d)}}},a.body&&a.body instanceof Blob?f(a.body,function(a){c.send(a)}):c.send(a.body),{abort:g}}function j(){try{return new XMLHttpRequest,!0}catch(a){return!1}}function k(a,b){return ed||a.xhr?i(a,b):h(a,b)}function l(a){Error.call(this,a.reason),this.status=a.status,this.name=a.error,this.message=a.reason,this.error=!0}function m(a,b,c){function d(b){for(var d in a)"function"!=typeof a[d]&&(this[d]=a[d]);void 0!==c&&(this.name=c),void 0!==b&&(this.reason=b)}return d.prototype=l.prototype,new d(b)}function n(a){var b,c,d,e,f;return c=a.error===!0&&"string"==typeof a.name?a.name:a.error,f=a.reason,d=Ed("name",c,f),a.missing||"missing"===f||"deleted"===f||"not_found"===c?d=hd:"doc_validation"===c?(d=rd,e=f):"bad_request"===c&&d.message!==f&&(d=sd),d||(d=Ed("status",a.status,f)||nd),b=m(d,f,c),e&&(b.message=e),a.id&&(b.id=a.id),a.status&&(b.status=a.status),a.missing&&(b.missing=a.missing),b}function o(a){return a instanceof ArrayBuffer||"undefined"!=typeof Blob&&a instanceof Blob}function p(a){if("function"==typeof a.slice)return a.slice(0);var b=new ArrayBuffer(a.byteLength),c=new Uint8Array(b),d=new Uint8Array(a);return c.set(d),b}function q(a){if(a instanceof ArrayBuffer)return p(a);var b=a.size,c=a.type;return"function"==typeof a.slice?a.slice(0,b,c):a.webkitSlice(0,b,c)}function r(a){var b,c,d;if(!a||"object"!=typeof a)return a;if(Array.isArray(a)){for(b=[],c=0,d=a.length;d>c;c++)b[c]=r(a[c]);return b}if(a instanceof Date)return a.toISOString();if(o(a))return q(a);b={};for(c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var e=r(a[c]);"undefined"!=typeof e&&(b[c]=e)}return b}function s(){return""}function t(a,b){function c(b,c,d){if(!a.binary&&a.json&&"string"==typeof b)try{b=JSON.parse(b)}catch(e){return d(e)}Array.isArray(b)&&(b=b.map(function(a){return a.error||a.missing?n(a):a})),a.binary&&Fd(b,c),d(null,b,c)}function d(a,b){var c,d;if(a.code&&a.status){var e=new Error(a.message||a.code);return e.status=a.status,b(e)}try{c=JSON.parse(a.responseText),d=n(c)}catch(f){d=n(a)}b(d)}a=r(a);var e={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};return a=Sc.extend(e,a),a.json&&(a.binary||(a.headers.Accept="application/json"),a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"),a.binary&&(a.encoding=null,a.json=!1),a.processData||(a.json=!1),k(a,function(e,f,g){if(e)return e.status=f?f.statusCode:400,d(e,b);var h,i=f.headers&&f.headers["content-type"],j=g||s();if(!a.binary&&(a.json||!a.processData)&&"object"!=typeof j&&(/json/.test(i)||/^[\s]*\{/.test(j)&&/\}[\s]*$/.test(j)))try{j=JSON.parse(j.toString())}catch(k){}f.statusCode>=200&&f.statusCode<300?c(j,f,b):(h=n(j),h.status=f.statusCode,b(h))})}function u(a,b){var c=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",d=-1!==c.indexOf("safari")&&-1===c.indexOf("chrome"),e=-1!==c.indexOf("msie"),f=d&&"POST"===a.method||e&&"GET"===a.method,g="cache"in a?a.cache:!0;if(f||!g){var h=-1!==a.url.indexOf("?");a.url+=(h?"&":"?")+"_nonce="+Date.now()}return t(a,b)}function v(a){var b=!1;return Xc(function(c){if(b)throw new Error("once called more than once");b=!0,a.apply(this,c)})}function w(a){return Xc(function(b){b=r(b);var d,e=this,f="function"==typeof b[b.length-1]?b.pop():!1;f&&(d=function(a,b){c.nextTick(function(){f(a,b)})});var g=new dd(function(c,d){var f;try{var g=v(function(a,b){a?d(a):c(b)});b.push(g),f=a.apply(e,b),f&&"function"==typeof f.then&&c(f)}catch(h){d(h)}});return d&&g.then(function(a){d(null,a)},d),g})}function x(a,b){function c(a,b,c){if(Gd.enabled){for(var d=[a._db_name,b],e=0;e<c.length-1;e++)d.push(c[e]);Gd.apply(null,d);var f=c[c.length-1];c[c.length-1]=function(c,d){var e=[a._db_name,b];e=e.concat(c?["error",c]:["success",d]),Gd.apply(null,e),f(c,d)}}}return w(Xc(function(d){if(this._closed)return dd.reject(new Error("database is closed"));var e=this;return c(e,a,d),this.taskqueue.isReady?b.apply(this,d):new dd(function(b,c){e.taskqueue.addTask(function(f){f?c(f):b(e[a].apply(e,d))})})}))}function y(a,b){for(var c={},d=0,e=b.length;e>d;d++){var f=b[d];f in a&&(c[f]=a[f])}return c}function z(a,b,c){return new dd(function(d,e){a.get(b,function(f,g){if(f){if(404!==f.status)return e(f);g={}}var h=g._rev,i=c(g);return i?(i._id=b,i._rev=h,void d(A(a,i,c))):d({updated:!1,rev:h})})})}function A(a,b,c){return a.put(b).then(function(a){return{updated:!0,rev:a.rev}},function(d){if(409!==d.status)throw d;return z(a,b._id,c)})}function B(a){for(var b,c,d,e,f=a.rev_tree.slice();e=f.pop();){var g=e.ids,h=g[2],i=e.pos;if(h.length)for(var j=0,k=h.length;k>j;j++)f.push({pos:i+1,ids:h[j]});else{var l=!!g[1].deleted,m=g[0];(!b||(d!==l?d:c!==i?i>c:m>b))&&(b=m,c=i,d=l)}}return c+"-"+b}function C(a){return a.ids}function D(a,b){b||(b=B(a));for(var c,d=b.substring(b.indexOf("-")+1),e=a.rev_tree.map(C);c=e.pop();){if(c[0]===d)return!!c[1].deleted;e=e.concat(c[2])}}function E(a){return ad("return "+a+";",{})}function F(a){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+a+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function G(a){if(!a)return null;var b=a.split("/");return 2===b.length?b:1===b.length?[a,a]:null}function H(a){var b=G(a);return b?b.join("/"):null}function I(a,b){for(var c,d=a.slice();c=d.pop();)for(var e=c.pos,f=c.ids,g=f[2],h=b(0===g.length,e,f[0],c.ctx,f[1]),i=0,j=g.length;j>i;i++)d.push({pos:e+1,ids:g[i],ctx:h})}function J(a,b){return a.pos-b.pos}function K(a){var b=[];I(a,function(a,c,d,e,f){a&&b.push({rev:c+"-"+d,pos:c,opts:f})}),b.sort(J).reverse();for(var c=0,d=b.length;d>c;c++)delete b[c].pos;return b}function L(a){for(var b=B(a),c=K(a.rev_tree),d=[],e=0,f=c.length;f>e;e++){var g=c[e];g.rev===b||g.opts.deleted||d.push(g.rev)}return d}function M(a,b,c){function d(){e.cancel()}Wc.EventEmitter.call(this);var e=this;this.db=a,b=b?r(b):{};var f=b.complete=v(function(b,c){b?e.emit("error",b):e.emit("complete",c),e.removeAllListeners(),a.removeListener("destroyed",d)});c&&(e.on("complete",function(a){c(null,a)}),e.on("error",c)),a.once("destroyed",d),b.onChange=function(a){b.isCancelled||(e.emit("change",a),e.startSeq&&e.startSeq<=a.seq&&(e.startSeq=!1))};var g=new dd(function(a,c){b.complete=function(b,d){b?c(b):a(d)}});e.once("cancel",function(){a.removeListener("destroyed",d),b.complete(null,{status:"cancelled"})}),this.then=g.then.bind(g),this["catch"]=g["catch"].bind(g),this.then(function(a){f(null,a)},f),a.taskqueue.isReady?e.doChanges(b):a.taskqueue.addTask(function(){e.isCancelled?e.emit("cancel"):e.doChanges(b)})}function N(a,b,c){var d=[{rev:a._rev}];"all_docs"===c.style&&(d=K(b.rev_tree).map(function(a){return{rev:a.rev}}));var e={id:b.id,changes:d,doc:a};return D(b,a._rev)&&(e.deleted=!0),c.conflicts&&(e.doc._conflicts=L(b),e.doc._conflicts.length||delete e.doc._conflicts),e}function O(a,b,c){function d(){var a=[];k.forEach(function(b){b.docs.forEach(function(c){a.push({id:b.id,docs:[c]})})}),c(null,{results:a})}function e(){++j===i&&d()}function f(a,b,c){k[a]={id:b,docs:c},e()}var g=Array.isArray(b)?b:b.docs,h={};g.forEach(function(a){a.id in h?h[a.id].push(a):h[a.id]=[a]});var i=Object.keys(h).length,j=0,k=new Array(i);Object.keys(h).forEach(function(c,d){var e=h[c],g=y(e[0],["atts_since","attachments"]);g.open_revs=e.map(function(a){return a.rev}),g.open_revs=g.open_revs.filter(function(a){return a});var i=function(a){return a};0===g.open_revs.length&&(delete g.open_revs,i=function(a){return[{ok:a}]}),["revs","attachments","binary"].forEach(function(a){a in b&&(g[a]=b[a])}),a.get(c,g,function(a,b){f(d,c,a?[{error:a}]:i(b))})})}function P(a){return/^_local/.test(a)}function Q(a){for(var b,c=[],d=a.slice();b=d.pop();){var e=b.pos,f=b.ids,g=f[0],h=f[1],i=f[2],j=0===i.length,k=b.history?b.history.slice():[];k.push({id:g,opts:h}),j&&c.push({pos:e+1-k.length,ids:k});for(var l=0,m=i.length;m>l;l++)d.push({pos:e+1,ids:i[l],history:k})}return c.reverse()}function R(a){return 0|Math.random()*a}function S(a,b){b=b||Hd.length;var c="",d=-1;if(a){for(;++d<a;)c+=Hd[R(b)];return c}for(;++d<36;)switch(d){case 8:case 13:case 18:case 23:c+="-";break;case 19:c+=Hd[3&R(16)|8];break;default:c+=Hd[R(16)]}return c}function T(a){return a.reduce(function(a,b){return a[b]=!0,a},{})}function U(a){var b;if(a?"string"!=typeof a?b=m(jd):/^_/.test(a)&&!/^_(design|local)/.test(a)&&(b=m(ld)):b=m(kd),b)throw b}function V(a){if(!/^\d+\-./.test(a))return m(zd);var b=a.indexOf("-"),c=a.substring(0,b),d=a.substring(b+1);return{prefix:parseInt(c,10),id:d}}function W(a,b){for(var c=a.start-a.ids.length+1,d=a.ids,e=[d[0],b,[]],f=1,g=d.length;g>f;f++)e=[d[f],{status:"missing"},[e]];return[{pos:c,ids:e}]}function X(a,b){var c,d,e,f={status:"available"};if(a._deleted&&(f.deleted=!0),b)if(a._id||(a._id=S()),d=S(32,16).toLowerCase(),a._rev){if(e=V(a._rev),e.error)return e;a._rev_tree=[{pos:e.prefix,ids:[e.id,{status:"missing"},[[d,f,[]]]]}],c=e.prefix+1}else a._rev_tree=[{pos:1,ids:[d,f,[]]}],c=1;else if(a._revisions&&(a._rev_tree=W(a._revisions,f),c=a._revisions.start,d=a._revisions.ids[0]),!a._rev_tree){if(e=V(a._rev),e.error)return e;c=e.prefix,d=e.id,a._rev_tree=[{pos:c,ids:[d,f,[]]}]}U(a._id),a._rev=c+"-"+d;var g={metadata:{},data:{}};for(var h in a)if(Object.prototype.hasOwnProperty.call(a,h)){var i="_"===h[0];if(i&&!Id[h]){var j=m(rd,h);throw j.message=rd.message+": "+h,j}i&&!Jd[h]?g.metadata[h.slice(1)]=a[h]:g.data[h]=a[h]}return g}function Y(a,b){return b>a?-1:a>b?1:0}function Z(a,b){for(var c=0;c<a.length;c++)if(b(a[c],c)===!0)return a[c]}function $(a){return function(b,c){b||c[0]&&c[0].error?a(b||c[0]):a(null,c.length?c[0]:c)}}function _(a){for(var b=0;b<a.length;b++){var c=a[b];if(c._deleted)delete c._attachments;else if(c._attachments)for(var d=Object.keys(c._attachments),e=0;e<d.length;e++){var f=d[e];c._attachments[f]=y(c._attachments[f],["data","digest","content_type","length","revpos","stub"])}}}function aa(a,b){var c=Y(a._id,b._id);if(0!==c)return c;var d=a._revisions?a._revisions.start:0,e=b._revisions?b._revisions.start:0;return Y(d,e)}function ba(a){var b={},c=[];return I(a,function(a,d,e,f){var g=d+"-"+e;return a&&(b[g]=0),void 0!==f&&c.push({from:f,to:g}),g}),c.reverse(),c.forEach(function(a){void 0===b[a.from]?b[a.from]=1+b[a.to]:b[a.from]=Math.min(b[a.from],1+b[a.to])}),b}function ca(a,b,c){var d="limit"in b?b.keys.slice(b.skip,b.limit+b.skip):b.skip>0?b.keys.slice(b.skip):b.keys;if(b.descending&&d.reverse(),!d.length)return a._allDocs({limit:0},c);var e={offset:b.skip};return dd.all(d.map(function(c){var d=Sc.extend({key:c,deleted:"ok"},b);return["limit","skip","keys"].forEach(function(a){delete d[a]}),new dd(function(b,f){a._allDocs(d,function(a,d){return a?f(a):(e.total_rows=d.total_rows,void b(d.rows[0]||{key:c,error:"not_found"}))})})})).then(function(a){return e.rows=a,e})}function da(a){var b=a._compactionQueue[0],d=b.opts,e=b.callback;a.get("_local/compaction")["catch"](function(){return!1}).then(function(b){b&&b.last_seq&&(d.last_seq=b.last_seq),a._compact(d,function(b,d){b?e(b):e(null,d),c.nextTick(function(){a._compactionQueue.shift(),a._compactionQueue.length&&da(a)})})})}function ea(a){return"_"===a.charAt(0)?a+"is not a valid attachment name, attachment names cannot start with '_'":!1}function fa(){Wc.EventEmitter.call(this)}function ga(){this.isReady=!1,this.failed=!1,this.queue=[]}function ha(a){a&&d.debug&&console.error(a)}function ia(a,b){function c(){f.emit("destroyed",e),f.emit(e,"destroyed")}function d(){a.removeListener("destroyed",c),a.emit("destroyed",a)}var e=b.originalName,f=a.constructor,g=f._destructionListeners;a.once("destroyed",c),g.has(e)||g.set(e,[]),g.get(e).push(d)}function ja(a,b,c){if(!(this instanceof ja))return new ja(a,b,c);var d=this;("function"==typeof b||"undefined"==typeof b)&&(c=b,b={}),a&&"object"==typeof a&&(b=a,a=void 0),"undefined"==typeof c&&(c=ha),a=a||b.name,b=r(b),delete b.name,this.__opts=b;var e=c;d.auto_compaction=b.auto_compaction,d.prefix=ja.prefix,fa.call(d),d.taskqueue=new ga;var f=new dd(function(e,f){c=function(a,b){return a?f(a):(delete b.then,void e(b))},b=r(b);var g,h,i=b.name||a;return function(){try{if("string"!=typeof i)throw h=new Error("Missing/invalid DB name"),h.code=400,h;if(g=ja.parseAdapter(i,b),b.originalName=i,b.name=g.name,b.prefix&&"http"!==g.adapter&&"https"!==g.adapter&&(b.name=b.prefix+b.name),b.adapter=b.adapter||g.adapter,d._adapter=b.adapter,Yc("pouchdb:adapter")("Picked adapter: "+b.adapter),d._db_name=i,!ja.adapters[b.adapter])throw h=new Error("Adapter is missing"),h.code=404,h;if(!ja.adapters[b.adapter].valid())throw h=new Error("Invalid Adapter"),h.code=404,h}catch(a){d.taskqueue.fail(a)}}(),h?f(h):(d.adapter=b.adapter,d.replicate={},d.replicate.from=function(a,b,c){return d.constructor.replicate(a,d,b,c)},d.replicate.to=function(a,b,c){return d.constructor.replicate(d,a,b,c)},d.sync=function(a,b,c){return d.constructor.sync(d,a,b,c)},d.replicate.sync=d.sync,void ja.adapters[b.adapter].call(d,b,function(a){return a?(d.taskqueue.fail(a),void c(a)):(ia(d,b),d.emit("created",d),ja.emit("created",b.originalName),d.taskqueue.ready(d),void c(null,d))}))});f.then(function(a){e(null,a)},e),d.then=f.then.bind(f),d["catch"]=f["catch"].bind(f)}function ka(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function la(){return Kd}function ma(a){Object.keys(Wc.EventEmitter.prototype).forEach(function(b){"function"==typeof Wc.EventEmitter.prototype[b]&&(a[b]=Md[b].bind(Md))});var b=a._destructionListeners=new Vc.Map;a.on("destroyed",function(a){b.has(a)&&(b.get(a).forEach(function(a){a()}),b["delete"](a))})}function na(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;b>e;e++)d[e]=a.charCodeAt(e);return c}function oa(a,b){return e([na(a)],{type:b})}function pa(a){for(var b=Sd.exec(a),c={},d=14;d--;){var e=Pd[d],f=b[d]||"",g=-1!==["user","password"].indexOf(e);c[e]=g?decodeURIComponent(f):f}return c[Qd]={},c[Pd[12]].replace(Rd,function(a,b,d){b&&(c[Qd][b]=d)}),c}function qa(a,b,c){try{return!a(b,c)}catch(d){var e="Filter function threw: "+d.toString();return m(sd,e)}}function ra(a){var b={},c=a.filter&&"function"==typeof a.filter;return b.query=a.query_params,function(d){d.doc||(d.doc={});var e=c&&qa(a.filter,d.doc,b);if("object"==typeof e)return e;if(e)return!1;if(a.include_docs){if(!a.attachments)for(var f in d.doc._attachments)d.doc._attachments.hasOwnProperty(f)&&(d.doc._attachments[f].stub=!0)}else delete d.doc;return!0}}function sa(a,b){"console"in d&&"info"in console&&console.info("The above "+a+" is totally normal. "+b)}function ta(a,b,c,d,e){return a.get(b)["catch"](function(c){if(404===c.status)return"http"===a.type()&&sa(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:d,_id:b,history:[],replicator:Xd,version:Wd};throw c}).then(function(f){return e.cancelled?void 0:(f.history=(f.history||[]).filter(function(a){return a.session_id!==d}),f.history.unshift({last_seq:c,session_id:d}),f.history=f.history.slice(0,Yd),f.version=Wd,f.replicator=Xd,f.session_id=d,f.last_seq=c,a.put(f)["catch"](function(f){if(409===f.status)return ta(a,b,c,d,e);throw f}))})}function ua(a,b,c,d){this.src=a,this.target=b,this.id=c,this.returnValue=d}function va(a,b){if(a.session_id===b.session_id)return{last_seq:a.last_seq,history:a.history||[]};var c=a.history||[],d=b.history||[];return wa(c,d)}function wa(a,b){var c=a[0],d=a.slice(1),e=b[0],f=b.slice(1);if(!c||0===b.length)return{last_seq:Zd,history:[]};var g=c.session_id;if(xa(g,b))return{last_seq:c.last_seq,history:a};var h=e.session_id;return xa(h,d)?{last_seq:e.last_seq,history:f}:wa(d,f)}function xa(a,b){var c=b[0],d=b.slice(1);return a&&0!==b.length?a===c.session_id?!0:xa(a,d):!1}function ya(a,b){a=parseInt(a,10)||0,b=parseInt(b,10),b!==b||a>=b?b=(a||1)<<1:b+=1;var c=Math.random(),d=b-a;return~~(d*c+a)}function za(a){var b=0;return a||(b=2e3),ya(a,b)}function Aa(a,b,c,d){return a.retry===!1?(b.emit("error",c),void b.removeAllListeners()):("function"!=typeof a.back_off_function&&(a.back_off_function=za),b.emit("requestError",c),("active"===b.state||"pending"===b.state)&&(b.emit("paused",c),b.state="stopped",b.once("active",function(){a.current_back_off=_d})),a.current_back_off=a.current_back_off||_d,a.current_back_off=a.back_off_function(a.current_back_off),void setTimeout(d,a.current_back_off))}function Ba(a){return Od(a)}function Ca(a,b,c,d){(c>0||d<b.byteLength)&&(b=new Uint8Array(b,c,Math.min(d,b.byteLength)-c)),a.append(b)}function Da(a,b,c,d){(c>0||d<b.length)&&(b=b.substring(c,d)),a.appendBinary(b)}function Ea(a){return Object.keys(a).sort(Zc.collate).reduce(function(b,c){return b[c]=a[c],b},{})}function Fa(a,b,c){var d=c.doc_ids?c.doc_ids.sort(Zc.collate):"",e=c.filter?c.filter.toString():"",f="",g="";return c.filter&&c.query_params&&(f=JSON.stringify(Ea(c.query_params))),c.filter&&"_view"===c.filter&&(g=c.view.toString()),dd.all([a.id(),b.id()]).then(function(a){var b=a[0]+a[1]+e+g+f+d;return ce(b)}).then(function(a){return a=a.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+a})}function Ga(a){return/^1-/.test(a)}function Ha(a){var b=[];return Object.keys(a).forEach(function(c){var d=a[c].missing;d.forEach(function(a){b.push({id:c,rev:a})})}),{docs:b,revs:!0,attachments:!0,binary:!0}}function Ia(a,b,c){function d(){var d=Ha(b);return d.docs.length?a.bulkGet(d).then(function(a){if(c.cancelled)throw new Error("cancelled");a.results.forEach(function(a){a.docs.forEach(function(a){a.ok&&i.push(a.ok)})})}):void 0}function e(a){return a._attachments&&Object.keys(a._attachments).length>0}function f(d){return a.allDocs({keys:d,include_docs:!0}).then(function(a){if(c.cancelled)throw new Error("cancelled");a.rows.forEach(function(a){!a.deleted&&a.doc&&Ga(a.value.rev)&&!e(a.doc)&&(i.push(a.doc),delete b[a.id])})})}function g(){var a=Object.keys(b).filter(function(a){var c=b[a].missing;return 1===c.length&&Ga(c[0])});return a.length>0?f(a):void 0}function h(){return i}b=r(b);var i=[];return dd.resolve().then(g).then(d).then(h)}function Ja(a,b,c,d,e){function f(){return x?dd.resolve():Fa(a,b,c).then(function(c){w=c,x=new ua(a,b,w,d)})}function g(){if(K=[],0!==v.docs.length){var a=v.docs;return b.bulkDocs({docs:a,new_edits:!1}).then(function(b){if(d.cancelled)throw n(),new Error("cancelled");var c=[],f={};b.forEach(function(a){a.error&&(e.doc_write_failures++,c.push(a),f[a.id]=a)}),J=J.concat(c),e.docs_written+=v.docs.length-c.length;var g=c.filter(function(a){return"unauthorized"!==a.name&&"forbidden"!==a.name});if(a.forEach(function(a){var b=f[a._id];b?d.emit("denied",r(b)):K.push(a)}),g.length>0){var h=new Error("bulkDocs error");throw h.other_errors=c,m("target.bulkDocs failed to write docs",h),new Error("bulkWrite partial failure")}},function(b){throw e.doc_write_failures+=a.length,b})}}function h(){e.last_seq=D=v.seq;var a=r(e);return K.length&&(a.docs=K,d.emit("change",a)),A=!0,x.writeCheckpoint(v.seq,L).then(function(){if(A=!1,d.cancelled)throw n(),new Error("cancelled");v=void 0,s()})["catch"](function(a){throw A=!1,m("writeCheckpoint completed with error",a),a})}function i(){var a={};return v.changes.forEach(function(b){"_user/"!==b.id&&(a[b.id]=b.changes.map(function(a){return a.rev}))}),b.revsDiff(a).then(function(a){if(d.cancelled)throw n(),new Error("cancelled");v.diffs=a})}function j(){return Ia(a,v.diffs,d).then(function(a){a.forEach(function(a){delete v.diffs[a._id],e.docs_read++,v.docs.push(a)})})}function k(){if(!d.cancelled&&!v){if(0===y.length)return void l(!0);v=y.shift(),i().then(j).then(g).then(h).then(k)["catch"](function(a){m("batch processing terminated with error",a)})}}function l(a){return 0===z.changes.length?void(0!==y.length||v||((E&&M.live||B)&&(d.state="pending",d.emit("paused")),B&&n())):void((a||B||z.changes.length>=F)&&(y.push(z),z={seq:0,changes:[],docs:[]},("pending"===d.state||"stopped"===d.state)&&(d.state="active",d.emit("active")),k()))}function m(a,b){C||(b.message||(b.message=a),e.ok=!1,e.status="aborting",e.errors.push(b),J=J.concat(b),y=[],z={seq:0,changes:[],docs:[]},n())}function n(){if(!(C||d.cancelled&&(e.status="cancelled",A))){e.status=e.status||"complete",e.end_time=new Date,e.last_seq=D,C=!0;var f=J.filter(function(a){return"unauthorized"!==a.name&&"forbidden"!==a.name});if(f.length>0){var g=J.pop();J.length>0&&(g.other_errors=J),g.result=e,Aa(c,d,g,function(){Ja(a,b,c,d)})}else e.errors=J,d.emit("complete",e),d.removeAllListeners()}}function o(a){if(d.cancelled)return n();var b=ra(c)(a);b&&(z.seq=a.seq,z.changes.push(a),l(0===y.length))}function p(a){return H=!1,d.cancelled?n():(a.results.length>0?(M.since=a.last_seq,s()):E?(M.live=!0,s()):B=!0,void l(!0))}function q(a){return H=!1,d.cancelled?n():void m("changes rejected",a)}function s(){function b(){f.cancel()}function e(){d.removeListener("cancel",b)}if(!H&&!B&&y.length<G){H=!0,d._changes&&(d.removeListener("cancel",d._abortChanges),d._changes.cancel()),d.once("cancel",b);var f=a.changes(M).on("change",o);f.then(e,e),f.then(p)["catch"](q),c.retry&&(d._changes=f,d._abortChanges=b)}}function t(){f().then(function(){return d.cancelled?void n():x.getCheckpoint().then(function(a){D=a,M={since:D,limit:F,batch_size:F,style:"all_docs",doc_ids:I,return_docs:!0},c.filter&&("string"!=typeof c.filter?M.include_docs=!0:M.filter=c.filter),"heartbeat"in c&&(M.heartbeat=c.heartbeat),"timeout"in c&&(M.timeout=c.timeout),c.query_params&&(M.query_params=c.query_params),c.view&&(M.view=c.view),s()})})["catch"](function(a){m("getCheckpoint rejected with ",a)})}function u(a){throw A=!1,m("writeCheckpoint completed with error",a),a}var v,w,x,y=[],z={seq:0,changes:[],docs:[]},A=!1,B=!1,C=!1,D=0,E=c.continuous||c.live||!1,F=c.batch_size||100,G=c.batches_limit||10,H=!1,I=c.doc_ids,J=[],K=[],L=S();e=e||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var M={};return d.ready(a,b),d.cancelled?void n():(d._addedListeners||(d.once("cancel",n),"function"==typeof c.complete&&(d.once("error",c.complete),d.once("complete",function(a){c.complete(null,a)})),d._addedListeners=!0),void("undefined"==typeof c.since?t():f().then(function(){return A=!0,x.writeCheckpoint(c.since,L)}).then(function(){return A=!1,d.cancelled?void n():(D=c.since,void t())})["catch"](u)))}function Ka(){Wc.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var a=this,b=new dd(function(b,c){a.once("complete",b),a.once("error",c)});a.then=function(a,c){return b.then(a,c)},a["catch"]=function(a){return b["catch"](a)},a["catch"](function(){})}function La(a,b){var c=b.PouchConstructor;return"string"==typeof a?new c(a,b):a}function Ma(a,b,c,d){if("function"==typeof c&&(d=c,c={}),"undefined"==typeof c&&(c={}),c.doc_ids&&!Array.isArray(c.doc_ids))throw m(sd,"`doc_ids` filter parameter is not a list.");c.complete=d,c=r(c),c.continuous=c.continuous||c.live,c.retry="retry"in c?c.retry:!1,c.PouchConstructor=c.PouchConstructor||this;var e=new Ka(c),f=La(a,c),g=La(b,c);return Ja(f,g,c,e),e}function Na(a,b,c,d){return"function"==typeof c&&(d=c,c={}),"undefined"==typeof c&&(c={}),c=r(c),c.PouchConstructor=c.PouchConstructor||this,a=de.toPouch(a,c),b=de.toPouch(b,c),new Oa(a,b,c,d)}function Oa(a,b,c,d){function e(a){n.emit("change",{direction:"pull",change:a})}function f(a){n.emit("change",{direction:"push",change:a})}function g(a){n.emit("denied",{direction:"push",doc:a})}function h(a){n.emit("denied",{direction:"pull",doc:a})}function i(){n.pushPaused=!0,n.pullPaused&&n.emit("paused")}function j(){n.pullPaused=!0,n.pushPaused&&n.emit("paused")}function k(){n.pushPaused=!1,n.pullPaused&&n.emit("active",{direction:"push"})}function l(){n.pullPaused=!1,n.pushPaused&&n.emit("active",{direction:"pull"})}function m(a){return function(b,c){var d="change"===b&&(c===e||c===f),m="denied"===b&&(c===h||c===g),o="paused"===b&&(c===j||c===i),p="active"===b&&(c===l||c===k);(d||m||o||p)&&(b in q||(q[b]={}),q[b][a]=!0,2===Object.keys(q[b]).length&&n.removeAllListeners(b))}}var n=this;this.canceled=!1;var o=c.push?Sc.extend({},c,c.push):c,p=c.pull?Sc.extend({},c,c.pull):c;this.push=ee(a,b,o),this.pull=ee(b,a,p),this.pushPaused=!0,this.pullPaused=!0;var q={};c.live&&(this.push.on("complete",n.pull.cancel.bind(n.pull)),this.pull.on("complete",n.push.cancel.bind(n.push))),this.on("newListener",function(a){"change"===a?(n.pull.on("change",e),n.push.on("change",f)):"denied"===a?(n.pull.on("denied",h),n.push.on("denied",g)):"active"===a?(n.pull.on("active",l),n.push.on("active",k)):"paused"===a&&(n.pull.on("paused",j),n.push.on("paused",i))}),this.on("removeListener",function(a){"change"===a?(n.pull.removeListener("change",e),n.push.removeListener("change",f)):"denied"===a?(n.pull.removeListener("denied",h),n.push.removeListener("denied",g)):"active"===a?(n.pull.removeListener("active",l),n.push.removeListener("active",k)):"paused"===a&&(n.pull.removeListener("paused",j),n.push.removeListener("paused",i))}),this.pull.on("removeListener",m("pull")),this.push.on("removeListener",m("push"));var r=dd.all([this.push,this.pull]).then(function(a){var b={push:a[0],pull:a[1]};return n.emit("complete",b),d&&d(null,b),n.removeAllListeners(),b},function(a){if(n.cancel(),d?d(a):n.emit("error",a),n.removeAllListeners(),d)throw a});this.then=function(a,b){return r.then(a,b)},this["catch"]=function(a){return r["catch"](a)}}function Pa(a,b){return oa(Nd(a),b)}function Qa(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;d>e;e++)b+=String.fromCharCode(c[e]);return b}function Ra(a,b){if("undefined"==typeof FileReader)return b(Qa((new FileReaderSync).readAsArrayBuffer(a)));var c=new FileReader,d="function"==typeof c.readAsBinaryString;c.onloadend=function(a){var c=a.target.result||"";return d?b(c):void b(Qa(c))},d?c.readAsBinaryString(a):c.readAsArrayBuffer(a)}function Sa(a){return new dd(function(b){Ra(a,function(a){b(Od(a))})})}function Ta(a){for(var b=[],c=0,d=a.length;d>c;c++)b=b.concat(a[c]);return b}function Ua(a){var b=a.doc&&a.doc._attachments;b&&Object.keys(b).forEach(function(a){var c=b[a];c.data=Pa(c.data,c.content_type)})}function Va(a){return/^_design/.test(a)?"_design/"+encodeURIComponent(a.slice(8)):/^_local/.test(a)?"_local/"+encodeURIComponent(a.slice(7)):encodeURIComponent(a)}function Wa(a){return a._attachments&&Object.keys(a._attachments)?dd.all(Object.keys(a._attachments).map(function(b){var c=a._attachments[b];return c.data&&"string"!=typeof c.data?Sa(c.data).then(function(a){c.data=a}):void 0})):dd.resolve()}function Xa(a){var b=pa(a);(b.user||b.password)&&(b.auth={username:b.user,password:b.password});var c=b.path.replace(/(^\/|\/$)/g,"").split("/");return b.db=c.pop(),-1===b.db.indexOf("%")&&(b.db=encodeURIComponent(b.db)),b.path=c.join("/"),b}function Ya(a,b){return Za(a,a.db+"/"+b)}function Za(a,b){var c=a.path?"/":"";return a.protocol+"://"+a.host+(a.port?":"+a.port:"")+"/"+a.path+c+b}function $a(a){return"?"+Object.keys(a).map(function(b){return b+"="+encodeURIComponent(a[b])}).join("&")}function _a(a,b){function c(a,b,c){var d=a.ajax||{},e=Sc.extend(r(l),d,b);return je(e.method+" "+e.url),Ud.ajax(e,c)}function d(a,b){return new dd(function(d,e){c(a,b,function(a,b){return a?e(a):void d(b)})})}function e(a,b){return x(a,Xc(function(a){f().then(function(c){return b.apply(this,a)})["catch"](function(b){var c=a.pop();c(b)})}))}function f(){if(a.skipSetup||a.skip_setup)return dd.resolve();if(p)return p;var b={method:"GET",url:k};return p=d({},b)["catch"](function(a){return a&&a.status&&404===a.status?(sa(404,"PouchDB is just detecting if the remote exists."),d({},{method:"PUT",url:k})):dd.reject(a)})["catch"](function(a){return a&&a.status&&412===a.status?!0:dd.reject(a)}),p["catch"](function(){p=null}),p}function g(a){return a.split("/").map(encodeURIComponent).join("/")}var h=this,i=Xa;a.getHost&&(i=a.getHost);var j=i(a.name,a),k=Ya(j,"");a=r(a);var l=a.ajax||{};if(h.getUrl=function(){return k},h.getHeaders=function(){return l.headers||{}},a.auth||j.auth){var n=a.auth||j.auth,o=Od(n.username+":"+n.password);l.headers=l.headers||{},l.headers.Authorization="Basic "+o}var p;setTimeout(function(){b(null,h)}),h.type=function(){return"http"},h.id=e("id",function(a){c({},{method:"GET",url:Za(j,"")},function(b,c){var d=c&&c.uuid?c.uuid+j.db:Ya(j,"");a(null,d)})}),h.request=e("request",function(a,b){a.url=Ya(j,a.url),c({},a,b)}),h.compact=e("compact",function(a,b){"function"==typeof a&&(b=a,a={}),a=r(a),c(a,{url:Ya(j,"_compact"),method:"POST"},function(){function c(){h.info(function(d,e){e&&!e.compact_running?b(null,{ok:!0}):setTimeout(c,a.interval||200)})}c()})}),h.bulkGet=x("bulkGet",function(a,b){function d(b){var d={};a.revs&&(d.revs=!0),a.attachments&&(d.attachments=!0),c({},{url:Ya(j,"_bulk_get"+$a(d)),method:"POST",body:{docs:a.docs}},b)}function e(){function c(a){return function(c,d){h[a]=d.results,++g===e&&b(null,{results:Ta(h)})}}for(var d=ge,e=Math.ceil(a.docs.length/d),g=0,h=new Array(e),i=0;e>i;i++){var j=y(a,["revs","attachments"]);j.docs=a.docs.slice(i*d,Math.min(a.docs.length,(i+1)*d)),O(f,j,c(i))}}var f=this,g=Za(j,""),h=he[g];"boolean"!=typeof h?d(function(a,c){if(a){var d=Math.floor(a.status/100);4===d||5===d?(he[g]=!1,sa(a.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),e()):b(a)}else he[g]=!0,b(null,c)}):h?d(b):e()}),h._info=function(a){f().then(function(){c({},{method:"GET",url:Ya(j,"")},function(b,c){return b?a(b):(c.host=Ya(j,""),void a(null,c))})})["catch"](a)},h.get=e("get",function(a,b,c){function e(a){var c=a._attachments,e=c&&Object.keys(c);return c&&e.length?dd.all(e.map(function(e){var f=c[e],h=Va(a._id)+"/"+g(e)+"?rev="+a._rev;return d(b,{method:"GET",url:Ya(j,h),binary:!0}).then(function(a){return b.binary?a:Sa(a)}).then(function(a){delete f.stub,delete f.length,f.data=a})})):void 0}function f(a){return Array.isArray(a)?dd.all(a.map(function(a){return a.ok?e(a.ok):void 0})):e(a)}"function"==typeof b&&(c=b,b={}),b=r(b);var h={};b.revs&&(h.revs=!0),b.revs_info&&(h.revs_info=!0),b.open_revs&&("all"!==b.open_revs&&(b.open_revs=JSON.stringify(b.open_revs)),h.open_revs=b.open_revs),b.rev&&(h.rev=b.rev),b.conflicts&&(h.conflicts=b.conflicts),a=Va(a);var i={method:"GET",url:Ya(j,a+$a(h))};d(b,i).then(function(a){return dd.resolve().then(function(){return b.attachments?f(a):void 0}).then(function(){c(null,a)})})["catch"](c)}),h.remove=e("remove",function(a,b,d,e){var f;"string"==typeof b?(f={_id:a,_rev:b},"function"==typeof d&&(e=d,
d={})):(f=a,"function"==typeof b?(e=b,d={}):(e=d,d=b));var g=f._rev||d.rev;c(d,{method:"DELETE",url:Ya(j,Va(f._id))+"?rev="+g},e)}),h.getAttachment=e("getAttachment",function(a,b,d,e){"function"==typeof d&&(e=d,d={});var f=d.rev?"?rev="+d.rev:"",h=Ya(j,Va(a))+"/"+g(b)+f;c(d,{method:"GET",url:h,binary:!0},e)}),h.removeAttachment=e("removeAttachment",function(a,b,d,e){var f=Ya(j,Va(a)+"/"+g(b))+"?rev="+d;c({},{method:"DELETE",url:f},e)}),h.putAttachment=e("putAttachment",function(a,b,d,e,f,h){"function"==typeof f&&(h=f,f=e,e=d,d=null);var i=Va(a)+"/"+g(b),k=Ya(j,i);if(d&&(k+="?rev="+d),"string"==typeof e){var n;try{n=Nd(e)}catch(o){return h(m(od,"Attachment is not a valid base64 string"))}e=n?oa(n,f):""}var p={headers:{"Content-Type":f},method:"PUT",url:k,processData:!1,body:e,timeout:l.timeout||6e4};c({},p,h)}),h._bulkDocs=function(a,b,d){a.new_edits=b.new_edits,f().then(function(){return dd.all(a.docs.map(Wa))}).then(function(){c(b,{method:"POST",url:Ya(j,"_bulk_docs"),body:a},function(a,b){return a?d(a):(b.forEach(function(a){a.ok=!0}),void d(null,b))})})["catch"](d)},h.allDocs=e("allDocs",function(a,b){"function"==typeof a&&(b=a,a={}),a=r(a);var c,e={},f="GET";a.conflicts&&(e.conflicts=!0),a.descending&&(e.descending=!0),a.include_docs&&(e.include_docs=!0),a.attachments&&(e.attachments=!0),a.key&&(e.key=JSON.stringify(a.key)),a.start_key&&(a.startkey=a.start_key),a.startkey&&(e.startkey=JSON.stringify(a.startkey)),a.end_key&&(a.endkey=a.end_key),a.endkey&&(e.endkey=JSON.stringify(a.endkey)),"undefined"!=typeof a.inclusive_end&&(e.inclusive_end=!!a.inclusive_end),"undefined"!=typeof a.limit&&(e.limit=a.limit),"undefined"!=typeof a.skip&&(e.skip=a.skip);var g=$a(e);if("undefined"!=typeof a.keys){var h="keys="+encodeURIComponent(JSON.stringify(a.keys));h.length+g.length+1<=ie?g+="&"+h:(f="POST",c={keys:a.keys})}d(a,{method:f,url:Ya(j,"_all_docs"+g),body:c}).then(function(c){a.include_docs&&a.attachments&&a.binary&&c.rows.forEach(Ua),b(null,c)})["catch"](b)}),h._changes=function(a){var b="batch_size"in a?a.batch_size:fe;a=r(a),a.timeout="timeout"in a?a.timeout:"timeout"in l?l.timeout:3e4;var d,e=a.timeout?{timeout:a.timeout-5e3}:{},g="undefined"!=typeof a.limit?a.limit:!1;d="return_docs"in a?a.return_docs:"returnDocs"in a?a.returnDocs:!0;var h=g;if(a.style&&(e.style=a.style),(a.include_docs||a.filter&&"function"==typeof a.filter)&&(e.include_docs=!0),a.attachments&&(e.attachments=!0),a.continuous&&(e.feed="longpoll"),a.conflicts&&(e.conflicts=!0),a.descending&&(e.descending=!0),"heartbeat"in a?a.heartbeat&&(e.heartbeat=a.heartbeat):e.heartbeat=1e4,a.filter&&"string"==typeof a.filter&&(e.filter=a.filter,"_view"===a.filter&&a.view&&"string"==typeof a.view&&(e.view=a.view)),a.query_params&&"object"==typeof a.query_params)for(var i in a.query_params)a.query_params.hasOwnProperty(i)&&(e[i]=a.query_params[i]);var k,m="GET";if(a.doc_ids){e.filter="_doc_ids";var n=JSON.stringify(a.doc_ids);n.length<ie?e.doc_ids=n:(m="POST",k={doc_ids:a.doc_ids})}var o,p,q=function(d,i){if(!a.aborted){e.since=d,"object"==typeof e.since&&(e.since=JSON.stringify(e.since)),a.descending?g&&(e.limit=h):e.limit=!g||h>b?b:h;var l={method:m,url:Ya(j,"_changes"+$a(e)),timeout:a.timeout,body:k};p=d,a.aborted||f().then(function(){o=c(a,l,i)})["catch"](i)}},s={results:[]},t=function(c,e){if(!a.aborted){var f=0;if(e&&e.results){f=e.results.length,s.last_seq=e.last_seq;var i={};i.query=a.query_params,e.results=e.results.filter(function(b){h--;var c=ra(a)(b);return c&&(a.include_docs&&a.attachments&&a.binary&&Ua(b),d&&s.results.push(b),a.onChange(b)),c})}else if(c)return a.aborted=!0,void a.complete(c);e&&e.last_seq&&(p=e.last_seq);var j=g&&0>=h||e&&b>f||a.descending;(!a.continuous||g&&0>=h)&&j?a.complete(null,s):setTimeout(function(){q(p,t)},0)}};return q(a.since||0,t),{cancel:function(){a.aborted=!0,o&&o.abort()}}},h.revsDiff=e("revsDiff",function(a,b,d){"function"==typeof b&&(d=b,b={}),c(b,{method:"POST",url:Ya(j,"_revs_diff"),body:a},d)}),h._close=function(a){a()},h._destroy=function(b,d){c(b,{url:Ya(j,""),method:"DELETE"},function(b,c){return b&&b.status&&404!==b.status?d(b):(h.emit("destroyed"),h.constructor.emit("destroyed",a.name),void d(null,c))})}}function ab(){this.promise=new dd(function(a){a()})}function bb(a){return bd.hash(a)}function cb(a){var b=a.db,c=a.viewName,d=a.map,e=a.reduce,f=a.temporary,g=d.toString()+(e&&e.toString())+"undefined";if(!f&&b._cachedViews){var h=b._cachedViews[g];if(h)return dd.resolve(h)}return b.info().then(function(a){function h(a){a.views=a.views||{};var b=c;-1===b.indexOf("/")&&(b=c+"/"+c);var d=a.views[b]=a.views[b]||{};return d[i]?void 0:(d[i]=!0,a)}var i=a.db_name+"-mrview-"+(f?"temp":bb(g));return z(b,"_local/mrviews",h).then(function(){return b.registerDependentDatabase(i).then(function(a){var c=a.db;c.auto_compaction=!0;var h={name:i,db:c,sourceDB:b,adapter:b.adapter,mapFun:d,reduceFun:e};return h.db.get("_local/lastSeq")["catch"](function(a){if(404!==a.status)throw a}).then(function(a){return h.seq=a?a.seq:0,f||(b._cachedViews=b._cachedViews||{},b._cachedViews[g]=h,h.db.once("destroyed",function(){delete b._cachedViews[g]})),h})})})})}function db(a,b,c,d,e,f){return ad("return ("+a.replace(/;\s*$/,"")+");",{emit:b,sum:c,log:d,isArray:e,toJSON:f})}function eb(a){return-1===a.indexOf("/")?[a,a]:a.split("/")}function fb(a){return 1===a.length&&/^1-/.test(a[0].rev)}function gb(a,b){try{a.emit("error",b)}catch(c){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(b)}}function hb(a,b,c){try{return{output:b.apply(null,c)}}catch(d){return gb(a,d),{error:d}}}function ib(a,b){var c=re(a.key,b.key);return 0!==c?c:re(a.value,b.value)}function jb(a,b,c){return c=c||0,"number"==typeof b?a.slice(c,b+c):c>0?a.slice(c):a}function kb(a){var b=a.value,c=b&&"object"==typeof b&&b._id||a.id;return c}function lb(a){a.rows.forEach(function(a){var b=a.doc&&a.doc._attachments;b&&Object.keys(b).forEach(function(a){var c=b[a];b[a].data=Pa(c.data,c.content_type)})})}function mb(a){return function(b){return a.include_docs&&a.attachments&&a.binary&&lb(b),b}}function nb(a){var b="builtin "+a+" function requires map values to be numbers or number arrays";return new Lb(b)}function ob(a){for(var b=0,c=0,d=a.length;d>c;c++){var e=a[c];if("number"!=typeof e){if(!Array.isArray(e))throw nb("_sum");b="number"==typeof b?[b]:b;for(var f=0,g=e.length;g>f;f++){var h=e[f];if("number"!=typeof h)throw nb("_sum");"undefined"==typeof b[f]?b.push(h):b[f]+=h}}else"number"==typeof b?b+=e:b[0]+=e}return b}function pb(a,b,c,d){var e=b[a];"undefined"!=typeof e&&(d&&(e=encodeURIComponent(JSON.stringify(e))),c.push(a+"="+e))}function qb(a){if("undefined"!=typeof a){var b=Number(a);return isNaN(b)||b!==parseInt(a,10)?a:b}}function rb(a){return a.group_level=qb(a.group_level),a.limit=qb(a.limit),a.skip=qb(a.skip),a}function sb(a){if(a){if("number"!=typeof a)return new Jb('Invalid value for integer: "'+a+'"');if(0>a)return new Jb('Invalid value for positive integer: "'+a+'"')}}function tb(a,b){var c=a.descending?"endkey":"startkey",d=a.descending?"startkey":"endkey";if("undefined"!=typeof a[c]&&"undefined"!=typeof a[d]&&re(a[c],a[d])>0)throw new Jb("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(b.reduce&&a.reduce!==!1){if(a.include_docs)throw new Jb("{include_docs:true} is invalid for reduce");if(a.keys&&a.keys.length>1&&!a.group&&!a.group_level)throw new Jb("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(b){var c=sb(a[b]);if(c)throw c})}function ub(a,b,c){var d,e=[],f="GET";if(pb("reduce",c,e),pb("include_docs",c,e),pb("attachments",c,e),pb("limit",c,e),pb("descending",c,e),pb("group",c,e),pb("group_level",c,e),pb("skip",c,e),pb("stale",c,e),pb("conflicts",c,e),pb("startkey",c,e,!0),pb("start_key",c,e,!0),pb("endkey",c,e,!0),pb("end_key",c,e,!0),pb("inclusive_end",c,e),pb("key",c,e,!0),e=e.join("&"),e=""===e?"":"?"+e,"undefined"!=typeof c.keys){var g=2e3,h="keys="+encodeURIComponent(JSON.stringify(c.keys));h.length+e.length+1<=g?e+=("?"===e[0]?"&":"?")+h:(f="POST","string"==typeof b?d={keys:c.keys}:b.keys=c.keys)}if("string"==typeof b){var i=eb(b);return a.request({method:f,url:"_design/"+i[0]+"/_view/"+i[1]+e,body:d}).then(mb(c))}return d=d||{},Object.keys(b).forEach(function(a){Array.isArray(b[a])?d[a]=b[a]:d[a]=b[a].toString()}),a.request({method:"POST",url:"_temp_view"+e,body:d}).then(mb(c))}function vb(a,b,c){return new dd(function(d,e){a._query(b,c,function(a,b){return a?e(a):void d(b)})})}function wb(a){return new dd(function(b,c){a._viewCleanup(function(a,d){return a?c(a):void b(d)})})}function xb(a){return function(b){if(404===b.status)return a;throw b}}function yb(a,b,c){function d(){return fb(k)?dd.resolve(h):b.db.get(g)["catch"](xb(h))}function e(a){return a.keys.length?b.db.allDocs({keys:a.keys,include_docs:!0}):dd.resolve({rows:[]})}function f(a,b){for(var c=[],d={},e=0,f=b.rows.length;f>e;e++){var g=b.rows[e],h=g.doc;if(h&&(c.push(h),d[h._id]=!0,h._deleted=!j[h._id],!h._deleted)){var i=j[h._id];"value"in i&&(h.value=i.value)}}var k=Object.keys(j);return k.forEach(function(a){if(!d[a]){var b={_id:a},e=j[a];"value"in e&&(b.value=e.value),c.push(b)}}),a.keys=xe(k.concat(a.keys)),c.push(a),c}var g="_local/doc_"+a,h={_id:g,keys:[]},i=c[a],j=i.indexableKeysToKeyValues,k=i.changes;return d().then(function(a){return e(a).then(function(b){return f(a,b)})})}function zb(a,b,c){var d="_local/lastSeq";return a.db.get(d)["catch"](xb({_id:d,seq:0})).then(function(d){var e=Object.keys(b);return dd.all(e.map(function(c){return yb(c,a,b)})).then(function(b){var e=Ta(b);return d.seq=c,e.push(d),a.db.bulkDocs({docs:e})})})}function Ab(a){var b="string"==typeof a?a:a.name,c=Ae[b];return c||(c=Ae[b]=new ab),c}function Bb(a){return we(Ab(a),function(){return Cb(a)})()}function Cb(a){function b(a,b){var c={id:e._id,key:te(a)};"undefined"!=typeof b&&null!==b&&(c.value=te(b)),d.push(c)}function c(b,c){return function(){return zb(a,b,c)}}var d,e,f;if("function"==typeof a.mapFun&&2===a.mapFun.length){var g=a.mapFun;f=function(a){return g(a,b)}}else f=db(a.mapFun.toString(),b,ob,qe,Array.isArray,JSON.parse);var h=a.seq||0,i=new ab;return new dd(function(b,g){function j(){i.finish().then(function(){a.seq=h,b()})}function k(){function b(a){g(a)}a.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:h,limit:Ce}).on("complete",function(b){var g=b.results;if(!g.length)return j();for(var l={},m=0,n=g.length;n>m;m++){var o=g[m];if("_"!==o.doc._id[0]){d=[],e=o.doc,e._deleted||hb(a.sourceDB,f,[e]),d.sort(ib);for(var p,q={},r=0,s=d.length;s>r;r++){var t=d[r],u=[t.key,t.id];0===re(t.key,p)&&u.push(r);var v=se(u);q[v]=t,p=t.key}l[o.doc._id]={indexableKeysToKeyValues:q,changes:o.changes}}h=o.seq}return i.add(c(l,h)),g.length<Ce?j():k()}).on("error",b)}k()})}function Db(a,b,c){0===c.group_level&&delete c.group_level;var d,e=c.group||c.group_level;d=De[a.reduceFun]?De[a.reduceFun]:db(a.reduceFun.toString(),null,ob,qe,Array.isArray,JSON.parse);var f=[],g=c.group_level;b.forEach(function(a){var b=f[f.length-1],c=e?a.key:null;return e&&Array.isArray(c)&&"number"==typeof g&&(c=c.length>g?c.slice(0,g):c),b&&0===re(b.key[0][0],c)?(b.key.push([c,a.id]),void b.value.push(a.value)):void f.push({key:[[c,a.id]],value:[a.value]})});for(var h=0,i=f.length;i>h;h++){var j=f[h],k=hb(a.sourceDB,d,[j.key,j.value,!1]);if(k.error&&k.error instanceof Lb)throw k.error;j.value=k.error?null:k.output,j.key=j.key[0][0]}return{rows:jb(f,c.limit,c.skip)}}function Eb(a,b){return we(Ab(a),function(){return Fb(a,b)})()}function Fb(a,b){function c(b){return b.include_docs=!0,a.db.allDocs(b).then(function(a){return e=a.total_rows,a.rows.map(function(a){if("value"in a.doc&&"object"==typeof a.doc.value&&null!==a.doc.value){var b=Object.keys(a.doc.value).sort(),c=["id","key","value"];if(!(c>b||b>c))return a.doc.value}var d=ue(a.doc._id);return{key:d[0],id:d[1],value:"value"in a.doc?a.doc.value:null}})})}function d(c){var d;if(d=f?Db(a,c,b):{total_rows:e,offset:g,rows:c},b.include_docs){var h=xe(c.map(kb));return a.sourceDB.allDocs({keys:h,include_docs:!0,conflicts:b.conflicts,attachments:b.attachments,binary:b.binary}).then(function(a){var b={};return a.rows.forEach(function(a){a.doc&&(b["$"+a.id]=a.doc)}),c.forEach(function(a){var c=kb(a),d=b["$"+c];d&&(a.doc=d)}),d})}return d}var e,f=a.reduceFun&&b.reduce!==!1,g=b.skip||0;if("undefined"==typeof b.keys||b.keys.length||(b.limit=0,delete b.keys),"undefined"!=typeof b.keys){var h=b.keys,i=h.map(function(a){var b={startkey:se([a]),endkey:se([a,{}])};return c(b)});return dd.all(i).then(Ta).then(d)}var j={descending:b.descending};if(b.start_key&&(b.startkey=b.start_key),b.end_key&&(b.endkey=b.end_key),"undefined"!=typeof b.startkey&&(j.startkey=se(b.descending?[b.startkey,{}]:[b.startkey])),"undefined"!=typeof b.endkey){var k=b.inclusive_end!==!1;b.descending&&(k=!k),j.endkey=se(k?[b.endkey,{}]:[b.endkey])}if("undefined"!=typeof b.key){var l=se([b.key]),m=se([b.key,{}]);j.descending?(j.endkey=l,j.startkey=m):(j.startkey=l,j.endkey=m)}return f||("number"==typeof b.limit&&(j.limit=b.limit),j.skip=g),c(j).then(d)}function Gb(a){return a.request({method:"POST",url:"_view_cleanup"})}function Hb(a){return a.get("_local/mrviews").then(function(b){var c={};Object.keys(b.views).forEach(function(a){var b=eb(a),d="_design/"+b[0],e=b[1];c[d]=c[d]||{},c[d][e]=!0});var d={keys:Object.keys(c),include_docs:!0};return a.allDocs(d).then(function(d){var e={};d.rows.forEach(function(a){var d=a.key.substring(8);Object.keys(c[a.key]).forEach(function(c){var f=d+"/"+c;b.views[f]||(f=c);var g=Object.keys(b.views[f]),h=a.doc&&a.doc.views&&a.doc.views[c];g.forEach(function(a){e[a]=e[a]||h})})});var f=Object.keys(e).filter(function(a){return!e[a]}),g=f.map(function(b){return we(Ab(b),function(){return new a.constructor(b,a.__opts).destroy()})()});return dd.all(g).then(function(){return{ok:!0}})})},xb({ok:!0}))}function Ib(a,b,d){if("http"===a.type())return ub(a,b,d);if("function"==typeof a._query)return vb(a,b,d);if("string"!=typeof b){tb(d,b);var e={db:a,viewName:"temp_view/temp_view",map:b.map,reduce:b.reduce,temporary:!0};return Be.add(function(){return cb(e).then(function(a){function b(){return a.db.destroy()}return ye(Bb(a).then(function(){return Eb(a,d)}),b)})}),Be.finish()}var f=b,g=eb(f),h=g[0],i=g[1];return a.get("_design/"+h).then(function(b){var e=b.views&&b.views[i];if(!e||"string"!=typeof e.map)throw new Kb("ddoc "+h+" has no view named "+i);tb(d,e);var g={db:a,viewName:f,map:e.map,reduce:e.reduce};return cb(g).then(function(a){return"ok"===d.stale||"update_after"===d.stale?("update_after"===d.stale&&c.nextTick(function(){Bb(a)}),Eb(a,d)):Bb(a).then(function(){return Eb(a,d)})})})}function Jb(a){this.status=400,this.name="query_parse_error",this.message=a,this.error=!0;try{Error.captureStackTrace(this,Jb)}catch(b){}}function Kb(a){this.status=404,this.name="not_found",this.message=a,this.error=!0;try{Error.captureStackTrace(this,Kb)}catch(b){}}function Lb(a){this.status=500,this.name="invalid_value",this.message=a,this.error=!0;try{Error.captureStackTrace(this,Lb)}catch(b){}}function Mb(a){return"'"+a+"'"}function Nb(a){return a.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function Ob(a){return a.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function Pb(a){return delete a._id,delete a._rev,JSON.stringify(a)}function Qb(a,b,c){return a=JSON.parse(a),a._id=b,a._rev=c,a}function Rb(a){for(var b="(";a--;)b+="?",a&&(b+=",");return b+")"}function Sb(a,b,c,d,e){return"SELECT "+a+" FROM "+("string"==typeof b?b:b.join(" JOIN "))+(c?" ON "+c:"")+(d?" WHERE "+("string"==typeof d?d:d.join(" AND ")):"")+(e?" ORDER BY "+e:"")}function Tb(a,b,c){function d(){++f===a.length&&e()}function e(){if(g.length){var a="SELECT DISTINCT digest AS digest FROM "+Ne+" WHERE seq IN "+Rb(g.length);c.executeSql(a,g,function(a,b){for(var c=[],d=0;d<b.rows.length;d++)c.push(b.rows.item(d).digest);if(c.length){var e="DELETE FROM "+Ne+" WHERE seq IN ("+g.map(function(){return"?"}).join(",")+")";a.executeSql(e,g,function(a){var b="SELECT digest FROM "+Ne+" WHERE digest IN ("+c.map(function(){return"?"}).join(",")+")";a.executeSql(b,c,function(a,b){for(var d=new Vc.Set,e=0;e<b.rows.length;e++)d.add(b.rows.item(e).digest);c.forEach(function(b){d.has(b)||(a.executeSql("DELETE FROM "+Ne+" WHERE digest=?",[b]),a.executeSql("DELETE FROM "+Ke+" WHERE digest=?",[b]))})})})}})}}if(a.length){var f=0,g=[];a.forEach(function(a){var e="SELECT seq FROM "+Je+" WHERE doc_id=? AND rev=?";c.executeSql(e,[b,a],function(a,b){if(!b.rows.length)return d();var c=b.rows.item(0).seq;g.push(c),a.executeSql("DELETE FROM "+Je+" WHERE seq=?",[c],d)})})}}function Ub(a){return function(b){console.error("WebSQL threw an error",b);var c=b&&b.constructor.toString().match(/function ([^\(]+)/),d=c&&c[1]||b.type,e=b.target||b.message;a(m(wd,e,d))}}function Vb(a){if("size"in a)return 1e6*a.size;var b=/Android/.test(window.navigator.userAgent);return b?5e6:1}function Wb(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(a){return openDatabase(a.name,a.version,a.description,a.size)}:void 0}function Xb(a,b){try{return{db:a(b)}}catch(c){return{error:c}}}function Yb(a){var b=Oe[a.name];if(!b){var c=Wb();b=Oe[a.name]=Xb(c,a),b.db&&(b.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)}return b}function Zb(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}function $b(a){ka()?chrome.storage.onChanged.addListener(function(b){null!=b.db_name&&a.emit(b.dbName.newValue)}):la()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(b){a.emit(b.key)}):window.attachEvent("storage",function(b){a.emit(b.key)}))}function _b(){Wc.EventEmitter.call(this),this._listeners={},$b(this)}function ac(a){return decodeURIComponent(window.escape(a))}function bc(a){return 65>a?a-48:a-55}function cc(a,b,c){for(var d="";c>b;)d+=String.fromCharCode(bc(a.charCodeAt(b++))<<4|bc(a.charCodeAt(b++)));return d}function dc(a,b,c){for(var d="";c>b;)d+=String.fromCharCode(bc(a.charCodeAt(b+2))<<12|bc(a.charCodeAt(b+3))<<8|bc(a.charCodeAt(b))<<4|bc(a.charCodeAt(b+1))),b+=4;return d}function ec(a,b){return"UTF-8"===b?ac(cc(a,0,a.length)):dc(a,0,a.length)}function fc(a){try{return JSON.parse(a)}catch(b){return cd.parse(a)}}function gc(a){try{return JSON.stringify(a)}catch(b){return cd.stringify(a)}}function hc(a,b,c){function d(a){try{return Nd(a)}catch(b){var c=m(od,"Attachment is not a valid base64 string");return{error:c}}}function e(a,c){if(a.stub)return c();if("string"==typeof a.data){var e=d(a.data);if(e.error)return c(e.error);a.length=e.length,"blob"===b?a.data=oa(e,a.content_type):"base64"===b?a.data=Od(e):a.data=e,ce(e).then(function(b){a.digest="md5-"+b,c()})}else f(a.data,function(d){"binary"===b?a.data=Qa(d):"base64"===b&&(a.data=Od(Qa(d))),ce(d).then(function(b){a.digest="md5-"+b,a.length=d.byteLength,c()})})}function g(){i++,a.length===i&&(h?c(h):c())}if(!a.length)return c();var h,i=0;a.forEach(function(a){function b(a){h=a,d++,d===c.length&&g()}var c=a.data&&a.data._attachments?Object.keys(a.data._attachments):[],d=0;if(!c.length)return g();for(var f in a.data._attachments)a.data._attachments.hasOwnProperty(f)&&e(a.data._attachments[f],b)})}function ic(a,b){return a.pos-b.pos}function jc(a,b,c){for(var d,e=0,f=a.length;f>e;)d=e+f>>>1,c(a[d],b)<0?e=d+1:f=d;return e}function kc(a,b,c){var d=jc(a,b,c);a.splice(d,0,b)}function lc(a,b){for(var c,d,e=b,f=a.length;f>e;e++){var g=a[e],h=[g.id,g.opts,[]];d?(d[2].push(h),d=h):c=d=h}return c}function mc(a,b){return a[0]<b[0]?-1:1}function nc(a,b){for(var c=[{tree1:a,tree2:b}],d=!1;c.length>0;){var e=c.pop(),f=e.tree1,g=e.tree2;(f[1].status||g[1].status)&&(f[1].status="available"===f[1].status||"available"===g[1].status?"available":"missing");for(var h=0;h<g[2].length;h++)if(f[2][0]){for(var i=!1,j=0;j<f[2].length;j++)f[2][j][0]===g[2][h][0]&&(c.push({tree1:f[2][j],tree2:g[2][h]}),i=!0);i||(d="new_branch",kc(f[2],g[2][h],mc))}else d="new_leaf",f[2][0]=g[2][h]}return{conflicts:d,tree:a}}function oc(a,b,c){var d,e=[],f=!1,g=!1;if(!a.length)return{tree:[b],conflicts:"new_leaf"};for(var h=0,i=a.length;i>h;h++){var j=a[h];if(j.pos===b.pos&&j.ids[0]===b.ids[0])d=nc(j.ids,b.ids),e.push({pos:j.pos,ids:d.tree}),f=f||d.conflicts,g=!0;else if(c!==!0){var k=j.pos<b.pos?j:b,l=j.pos<b.pos?b:j,m=l.pos-k.pos,n=[],o=[];for(o.push({ids:k.ids,diff:m,parent:null,parentIdx:null});o.length>0;){var p=o.pop();if(0!==p.diff)for(var q=p.ids[2],r=0,s=q.length;s>r;r++)o.push({ids:q[r],diff:p.diff-1,parent:p.ids,parentIdx:r});else p.ids[0]===l.ids[0]&&n.push(p)}var t=n[0];t?(d=nc(t.ids,l.ids),t.parent[2][t.parentIdx]=d.tree,e.push({pos:k.pos,ids:k.ids}),f=f||d.conflicts,g=!0):e.push(j)}else e.push(j)}return g||e.push(b),e.sort(ic),{tree:e,conflicts:f||"internal_node"}}function pc(a,b){for(var c,d=Q(a),e=0,f=d.length;f>e;e++){var g=d[e],h=g.ids,i=Math.max(0,h.length-b),j={pos:g.pos+i,ids:lc(h,i)};c=c?oc(c,j,!0).tree:[j]}return c}function qc(a,b,c){var d=oc(a,b);return{tree:pc(d.tree,c),conflicts:d.conflicts}}function rc(a,b){for(var c,d=a.slice(),e=b.split("-"),f=parseInt(e[0],10),g=e[1];c=d.pop();){if(c.pos===f&&c.ids[0]===g)return!0;for(var h=c.ids[2],i=0,j=h.length;j>i;i++)d.push({pos:c.pos+1,ids:h[i]})}return!1}function sc(a,b,c,d,e,f,g,h){if(rc(b.rev_tree,c.metadata.rev))return d[e]=c,f();var i=b.winningRev||B(b),j="deleted"in b?b.deleted:D(b,i),k="deleted"in c.metadata?c.metadata.deleted:D(c.metadata),l=/^1-/.test(c.metadata.rev);if(j&&!k&&h&&l){var n=c.data;n._rev=i,n._id=c.metadata.id,c=X(n,h)}var o=qc(b.rev_tree,c.metadata.rev_tree[0],a),p=h&&(j&&k||!j&&"new_leaf"!==o.conflicts||j&&!k&&"new_branch"===o.conflicts);if(p){var q=m(id);return d[e]=q,f()}var r=c.metadata.rev;c.metadata.rev_tree=o.tree,b.rev_map&&(c.metadata.rev_map=b.rev_map);var s,t=B(c.metadata),u=D(c.metadata,t),v=j===u?0:u>j?-1:1;s=r===t?u:D(c.metadata,r),g(c,t,u,s,!0,v,e,f)}function tc(a){return"missing"===a.metadata.rev_tree[0].ids[1].status}function uc(a,b,c,d,e,f,g,h,i){function j(a,b,c){var d=B(a.metadata),e=D(a.metadata,d);if("was_delete"in h&&e)return f[b]=m(hd,"deleted"),c();var i=l&&tc(a);if(i){var j=m(id);return f[b]=j,c()}var k=e?0:1;g(a,d,e,e,!1,k,b,c)}function k(){++o===p&&i&&i()}a=a||1e3;var l=h.new_edits,n=new Vc.Map,o=0,p=b.length;b.forEach(function(a,b){if(a._id&&P(a._id)){var d=a._deleted?"_removeLocal":"_putLocal";return void c[d](a,{ctx:e},function(a,c){f[b]=a||c,k()})}var g=a.metadata.id;n.has(g)?(p--,n.get(g).push([a,b])):n.set(g,[[a,b]])}),n.forEach(function(b,c){function e(){++i<b.length?h():k()}function h(){var h=b[i],k=h[0],m=h[1];if(d.has(c))sc(a,d.get(c),k,f,m,e,g,l);else{var n=qc([],k.metadata.rev_tree[0],a);k.metadata.rev_tree=n.tree,j(k,m,e)}}var i=0;h()})}function vc(a){var b=[];return I(a.rev_tree,function(a,c,d,e,f){"available"!==f.status||a||(b.push(c+"-"+d),f.status="missing")}),b}function wc(a,b,c,d,e,f,g){function h(){return u?g(u):(f.notify(d._name),d._docCount=-1,void g(null,v))}function i(a,b){var c="SELECT count(*) as cnt FROM "+Ke+" WHERE digest=?";t.executeSql(c,[a],function(c,d){if(0===d.rows.item(0).cnt){var e=m(Bd,"unknown stub attachment with digest "+a);b(e)}else b()})}function j(a){function b(){++e===c.length&&a(d)}var c=[];if(r.forEach(function(a){a.data&&a.data._attachments&&Object.keys(a.data._attachments).forEach(function(b){var d=a.data._attachments[b];d.stub&&c.push(d.digest)})}),!c.length)return a();var d,e=0;c.forEach(function(a){i(a,function(a){a&&!d&&(d=a),b()})})}function k(a,b,c,e,f,g,h,i){function j(){function b(a,b){function d(){return++f===g.length&&b(),!1}function e(b){var e="INSERT INTO "+Ne+" (digest, seq) VALUES (?,?)",f=[c._attachments[b].digest,a];t.executeSql(e,f,d,d)}var f=0,g=Object.keys(c._attachments||{});if(!g.length)return b();for(var h=0;h<g.length;h++)e(g[h])}var c=a.data,d=e?1:0,f=c._id,g=c._rev,h=Pb(c),i="INSERT INTO "+Je+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",j=[f,g,h,d];t.executeSql(i,j,function(a,c){var d=c.insertId;b(d,function(){n(a,d)})},function(){var a=Sb("seq",Je,null,"doc_id=? AND rev=?");return t.executeSql(a,[f,g],function(a,c){var e=c.rows.item(0).seq,i="UPDATE "+Je+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",j=[h,d,f,g];a.executeSql(i,j,function(a){b(e,function(){n(a,e)})})}),!1})}function k(a){p||(a?(p=a,i(p)):q===r.length&&j())}function l(a){q++,k(a)}function m(){if(f&&d.auto_compaction){var b=a.metadata.id,c=vc(a.metadata);Tb(c,b,t)}}function n(c,d){m(),a.metadata.seq=d,delete a.metadata.rev;var e=f?"UPDATE "+Ie+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+Je+" WHERE doc_id="+Ie+".id AND rev=?) WHERE id=?":"INSERT INTO "+Ie+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",g=gc(a.metadata),j=a.metadata.id,k=f?[g,d,b,j]:[j,d,d,g];c.executeSql(e,k,function(){v[h]={ok:!0,id:a.metadata.id,rev:b},w.set(j,a.metadata),i()})}var p=null,q=0;a.data._id=a.metadata.id,a.data._rev=a.metadata.rev;var r=Object.keys(a.data._attachments||{});e&&(a.data._deleted=!0),r.forEach(function(b){var c=a.data._attachments[b];if(c.stub)q++,k();else{var d=c.data;delete c.data;var e=c.digest;o(e,d,l)}}),r.length||j()}function l(){uc(a.revs_limit,r,d,w,t,v,k,c)}function n(a){function b(){++c===r.length&&a()}if(!r.length)return a();var c=0;r.forEach(function(a){if(a._id&&P(a._id))return b();var c=a.metadata.id;t.executeSql("SELECT json FROM "+Ie+" WHERE id = ?",[c],function(a,d){if(d.rows.length){var e=fc(d.rows.item(0).json);w.set(c,e)}b()})})}function o(a,b,c){var d="SELECT digest FROM "+Ke+" WHERE digest=?";t.executeSql(d,[a],function(e,f){return f.rows.length?c():(d="INSERT INTO "+Ke+" (digest, body, escaped) VALUES (?,?,1)",void e.executeSql(d,[a,Nb(b)],function(){c()},function(){return c(),!1}))})}var p=c.new_edits,q=b.docs,r=q.map(function(a){if(a._id&&P(a._id))return a;var b=X(a,p);return b}),s=r.filter(function(a){return a.error});if(s.length)return g(s[0]);var t,u,v=new Array(r.length),w=new Vc.Map;hc(r,"binary",function(a){return a?g(a):void e.transaction(function(a){t=a,j(function(a){a?u=a:n(l)})},Ub(g),h)})}function xc(a,b,c,d,e){function f(){++i===h.length&&e&&e()}function g(a,e){var g=a._attachments[e],h={binary:b.binary,ctx:d};c._getAttachment(g,h,function(b,c){a._attachments[e]=Sc.extend(y(g,["digest","content_type"]),{data:c}),f()})}var h=Object.keys(a._attachments||{});if(!h.length)return e&&e();var i=0;h.forEach(function(c){b.attachments&&b.include_docs?g(a,c):(a._attachments[c].stub=!0,f())})}function yc(a,b){function c(){la()&&(window.localStorage["_pouch__websqldb_"+s._name]=!0),b(null,s)}function d(a,b){a.executeSql(Se),a.executeSql("ALTER TABLE "+Je+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){a.executeSql(Qe),a.executeSql("ALTER TABLE "+Ie+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){a.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+Ie+" (local, id)");var c="SELECT "+Ie+".winningseq AS seq, "+Ie+".json AS metadata FROM "+Je+" JOIN "+Ie+" ON "+Je+".seq = "+Ie+".winningseq";a.executeSql(c,[],function(a,c){for(var d=[],e=[],f=0;f<c.rows.length;f++){var g=c.rows.item(f),h=g.seq,i=JSON.parse(g.metadata);D(i)&&d.push(h),P(i.id)&&e.push(i.id)}a.executeSql("UPDATE "+Ie+"SET local = 1 WHERE id IN "+Rb(e.length),e,function(){a.executeSql("UPDATE "+Je+" SET deleted = 1 WHERE seq IN "+Rb(d.length),d,b)})})})})}function e(a,b){var c="CREATE TABLE IF NOT EXISTS "+Le+" (id UNIQUE, rev, json)";a.executeSql(c,[],function(){var c="SELECT "+Ie+".id AS id, "+Je+".json AS data FROM "+Je+" JOIN "+Ie+" ON "+Je+".seq = "+Ie+".winningseq WHERE local = 1";a.executeSql(c,[],function(a,c){function d(){if(!e.length)return b(a);var c=e.shift(),f=JSON.parse(c.data)._rev;a.executeSql("INSERT INTO "+Le+" (id, rev, json) VALUES (?,?,?)",[c.id,f,c.data],function(a){a.executeSql("DELETE FROM "+Ie+" WHERE id=?",[c.id],function(a){a.executeSql("DELETE FROM "+Je+" WHERE seq=?",[c.seq],function(){d()})})})}for(var e=[],f=0;f<c.rows.length;f++)e.push(c.rows.item(f));d()})})}function f(a,b){function c(c){function d(){if(!c.length)return b(a);var e=c.shift(),f=ec(e.hex,q),g=f.lastIndexOf("::"),h=f.substring(0,g),i=f.substring(g+2),j="UPDATE "+Je+" SET doc_id=?, rev=? WHERE doc_id_rev=?";a.executeSql(j,[h,i,f],function(){d()})}d()}var d="ALTER TABLE "+Je+" ADD COLUMN doc_id";a.executeSql(d,[],function(a){var b="ALTER TABLE "+Je+" ADD COLUMN rev";a.executeSql(b,[],function(a){a.executeSql(Re,[],function(a){var b="SELECT hex(doc_id_rev) as hex FROM "+Je;a.executeSql(b,[],function(a,b){for(var d=[],e=0;e<b.rows.length;e++)d.push(b.rows.item(e));c(d)})})})})}function g(a,b){function c(a){var c="SELECT COUNT(*) AS cnt FROM "+Ke;a.executeSql(c,[],function(a,c){function d(){var c=Sb(We+", "+Ie+".id AS id",[Ie,Je],Ve,null,Ie+".id ");c+=" LIMIT "+g+" OFFSET "+f,f+=g,a.executeSql(c,[],function(a,c){function e(a,b){var c=f[a]=f[a]||[];-1===c.indexOf(b)&&c.push(b)}if(!c.rows.length)return b(a);for(var f={},g=0;g<c.rows.length;g++)for(var h=c.rows.item(g),i=Qb(h.data,h.id,h.rev),j=Object.keys(i._attachments||{}),k=0;k<j.length;k++){var l=i._attachments[j[k]];e(l.digest,h.seq)}var m=[];if(Object.keys(f).forEach(function(a){var b=f[a];b.forEach(function(b){m.push([a,b])})}),!m.length)return d();var n=0;m.forEach(function(b){var c="INSERT INTO "+Ne+" (digest, seq) VALUES (?,?)";a.executeSql(c,b,function(){++n===m.length&&d()})})})}var e=c.rows.item(0).cnt;if(!e)return b(a);var f=0,g=10;d()})}var d="CREATE TABLE IF NOT EXISTS "+Ne+" (digest, seq INTEGER)";a.executeSql(d,[],function(a){a.executeSql(Ue,[],function(a){a.executeSql(Te,[],c)})})}function h(a,b){var c="ALTER TABLE "+Ke+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";a.executeSql(c,[],b)}function i(a,b){var c="ALTER TABLE "+Ie+" ADD COLUMN max_seq INTEGER";a.executeSql(c,[],function(a){var c="UPDATE "+Ie+" SET max_seq=(SELECT MAX(seq) FROM "+Je+" WHERE doc_id=id)";a.executeSql(c,[],function(a){var c="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+Ie+" (max_seq)";a.executeSql(c,[],b)})})}function j(a,b){a.executeSql('SELECT HEX("a") AS hex',[],function(a,c){var d=c.rows.item(0).hex;q=2===d.length?"UTF-8":"UTF-16",b()})}function k(){for(;v.length>0;){var a=v.pop();a(null,t)}}function l(a,b){if(0===b){var c="CREATE TABLE IF NOT EXISTS "+Me+" (dbid, db_version INTEGER)",j="CREATE TABLE IF NOT EXISTS "+Ke+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",l="CREATE TABLE IF NOT EXISTS "+Ne+" (digest, seq INTEGER)",m="CREATE TABLE IF NOT EXISTS "+Ie+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",n="CREATE TABLE IF NOT EXISTS "+Je+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",o="CREATE TABLE IF NOT EXISTS "+Le+" (id UNIQUE, rev, json)";a.executeSql(j),a.executeSql(o),a.executeSql(l,[],function(){a.executeSql(Te),a.executeSql(Ue)}),a.executeSql(m,[],function(){a.executeSql(Se),a.executeSql(n,[],function(){a.executeSql(Qe),a.executeSql(Re),a.executeSql(c,[],function(){var b="INSERT INTO "+Me+" (db_version, dbid) VALUES (?,?)";t=S();var c=[He,t];a.executeSql(b,c,function(){k()})})})})}else{var p=function(){var c=He>b;c&&a.executeSql("UPDATE "+Me+" SET db_version = "+He);var d="SELECT dbid FROM "+Me;a.executeSql(d,[],function(a,b){t=b.rows.item(0).dbid,k()})},q=[d,e,f,g,h,i,p],r=b,s=function(a){q[r-1](a,s),r++};s(a)}}function n(){y.transaction(function(a){j(a,function(){o(a)})},Ub(b),c)}function o(a){var b="SELECT sql FROM sqlite_master WHERE tbl_name = "+Me;a.executeSql(b,[],function(a,b){b.rows.length?/db_version/.test(b.rows.item(0).sql)?a.executeSql("SELECT db_version FROM "+Me,[],function(a,b){var c=b.rows.item(0).db_version;l(a,c)}):a.executeSql("ALTER TABLE "+Me+" ADD COLUMN db_version INTEGER",[],function(){l(a,1)}):l(a,0)})}function p(a,b){if(-1!==s._docCount)return b(s._docCount);
var c=Sb("COUNT("+Ie+".id) AS 'num'",[Ie,Je],Ve,Je+".deleted=0");a.executeSql(c,[],function(a,c){s._docCount=c.rows.item(0).num,b(s._docCount)})}var q,s=this,t=null,u=Vb(a),v=[];s._docCount=-1,s._name=a.name;var x=Yb({name:s._name,version:Pe,description:s._name,size:u,location:a.location,createFromLocation:a.createFromLocation,androidDatabaseImplementation:a.androidDatabaseImplementation});if(x.error)return Ub(b)(x.error);var y=x.db;"function"!=typeof y.readTransaction&&(y.readTransaction=y.transaction),n(),s.type=function(){return"websql"},s._id=w(function(a){a(null,t)}),s._info=function(a){y.readTransaction(function(b){p(b,function(c){var d="SELECT MAX(seq) AS seq FROM "+Je;b.executeSql(d,[],function(b,d){var e=d.rows.item(0).seq||0;a(null,{doc_count:c,update_seq:e,sqlite_plugin:y._sqlitePlugin,websql_encoding:q})})})},Ub(a))},s._bulkDocs=function(b,c,d){wc(a,b,c,s,y,yc.Changes,d)},s._get=function(a,b,c){function d(){c(g,{doc:e,metadata:f,ctx:h})}var e,f,g,h=b.ctx;if(!h)return y.readTransaction(function(d){s._get(a,Sc.extend({ctx:d},b),c)});var i,j;b.rev?(i=Sb(We,[Ie,Je],Ie+".id="+Je+".doc_id",[Je+".doc_id=?",Je+".rev=?"]),j=[a,b.rev]):(i=Sb(We,[Ie,Je],Ve,Ie+".id=?"),j=[a]),h.executeSql(i,j,function(a,c){if(!c.rows.length)return g=m(hd,"missing"),d();var h=c.rows.item(0);return f=fc(h.metadata),h.deleted&&!b.rev?(g=m(hd,"deleted"),d()):(e=Qb(h.data,f.id,h.rev),void d())})},s._allDocs=function(a,b){var c,d=[],e="startkey"in a?a.startkey:!1,f="endkey"in a?a.endkey:!1,g="key"in a?a.key:!1,h="descending"in a?a.descending:!1,i="limit"in a?a.limit:-1,j="skip"in a?a.skip:0,k=a.inclusive_end!==!1,l=[],m=[];if(g!==!1)m.push(Ie+".id = ?"),l.push(g);else if(e!==!1||f!==!1){if(e!==!1&&(m.push(Ie+".id "+(h?"<=":">=")+" ?"),l.push(e)),f!==!1){var n=h?">":"<";k&&(n+="="),m.push(Ie+".id "+n+" ?"),l.push(f)}g!==!1&&(m.push(Ie+".id = ?"),l.push(g))}"ok"!==a.deleted&&m.push(Je+".deleted = 0"),y.readTransaction(function(b){p(b,function(e){if(c=e,0!==i){var f=Sb(We,[Ie,Je],Ve,m,Ie+".id "+(h?"DESC":"ASC"));f+=" LIMIT "+i+" OFFSET "+j,b.executeSql(f,l,function(b,c){for(var e=0,f=c.rows.length;f>e;e++){var g=c.rows.item(e),h=fc(g.metadata),i=h.id,j=Qb(g.data,i,g.rev),k=j._rev,l={id:i,key:i,value:{rev:k}};if(a.include_docs&&(l.doc=j,l.doc._rev=k,a.conflicts&&(l.doc._conflicts=L(h)),xc(l.doc,a,s,b)),g.deleted){if("ok"!==a.deleted)continue;l.value.deleted=!0,l.doc=null}d.push(l)}})}})},Ub(b),function(){b(null,{total_rows:c,offset:a.skip,rows:d})})},s._changes=function(a){function b(){var b=Ie+".json AS metadata, "+Ie+".max_seq AS maxSeq, "+Je+".json AS winningDoc, "+Je+".rev AS winningRev ",c=Ie+" JOIN "+Je,i=Ie+".id="+Je+".doc_id AND "+Ie+".winningseq="+Je+".seq",j=["maxSeq > ?"],k=[a.since];a.doc_ids&&(j.push(Ie+".id IN "+Rb(a.doc_ids.length)),k=k.concat(a.doc_ids));var l="maxSeq "+(d?"DESC":"ASC"),m=Sb(b,c,i,j,l),n=ra(a);a.view||a.filter||(m+=" LIMIT "+e);var o=a.since||0;y.readTransaction(function(b){b.executeSql(m,k,function(b,c){function d(b){return function(){a.onChange(b)}}for(var i=0,j=c.rows.length;j>i;i++){var k=c.rows.item(i),l=fc(k.metadata);o=k.maxSeq;var m=Qb(k.winningDoc,l.id,k.winningRev),p=a.processChange(m,l,a);p.seq=k.maxSeq;var q=n(p);if("object"==typeof q)return a.complete(q);if(q&&(h++,f&&g.push(p),a.attachments&&a.include_docs?xc(m,a,s,b,d(p)):d(p)()),h===e)break}})},Ub(a.complete),function(){a.continuous||a.complete(null,{results:g,last_seq:o})})}if(a=r(a),a.continuous){var c=s._name+":"+S();return yc.Changes.addListener(s._name,c,s,a),yc.Changes.notify(s._name),{cancel:function(){yc.Changes.removeListener(s._name,c)}}}var d=a.descending;a.since=a.since&&!d?a.since:0;var e="limit"in a?a.limit:-1;0===e&&(e=1);var f;f="return_docs"in a?a.return_docs:"returnDocs"in a?a.returnDocs:!0;var g=[],h=0;b()},s._close=function(a){a()},s._getAttachment=function(a,b,c){var d,e=b.ctx,f=a.digest,g=a.content_type,h="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+Ke+" WHERE digest=?";e.executeSql(h,[f],function(a,e){var f=e.rows.item(0),h=f.escaped?Ob(f.body):ec(f.body,q);d=b.binary?oa(h,g):Od(h),c(null,d)})},s._getRevisionTree=function(a,b){y.readTransaction(function(c){var d="SELECT json AS metadata FROM "+Ie+" WHERE id = ?";c.executeSql(d,[a],function(a,c){if(c.rows.length){var d=fc(c.rows.item(0).metadata);b(null,d.rev_tree)}else b(m(hd))})})},s._doCompaction=function(a,b,c){return b.length?void y.transaction(function(c){var d="SELECT json AS metadata FROM "+Ie+" WHERE id = ?";c.executeSql(d,[a],function(c,d){var e=fc(d.rows.item(0).metadata);I(e.rev_tree,function(a,c,d,e,f){var g=c+"-"+d;-1!==b.indexOf(g)&&(f.status="missing")});var f="UPDATE "+Ie+" SET json = ? WHERE id = ?";c.executeSql(f,[gc(e),a])}),Tb(b,a,c)},Ub(c),function(){c()}):c()},s._getLocal=function(a,b){y.readTransaction(function(c){var d="SELECT json, rev FROM "+Le+" WHERE id=?";c.executeSql(d,[a],function(c,d){if(d.rows.length){var e=d.rows.item(0),f=Qb(e.json,a,e.rev);b(null,f)}else b(m(hd))})})},s._putLocal=function(a,b,c){function d(a){var d,j;f?(d="UPDATE "+Le+" SET rev=?, json=? WHERE id=? AND rev=?",j=[e,i,g,f]):(d="INSERT INTO "+Le+" (id, rev, json) VALUES (?,?,?)",j=[g,e,i]),a.executeSql(d,j,function(a,d){d.rowsAffected?(h={ok:!0,id:g,rev:e},b.ctx&&c(null,h)):c(m(id))},function(){return c(m(id)),!1})}"function"==typeof b&&(c=b,b={}),delete a._revisions;var e,f=a._rev,g=a._id;e=f?a._rev="0-"+(parseInt(f.split("-")[1],10)+1):a._rev="0-1";var h,i=Pb(a);b.ctx?d(b.ctx):y.transaction(d,Ub(c),function(){h&&c(null,h)})},s._removeLocal=function(a,b,c){function d(d){var f="DELETE FROM "+Le+" WHERE id=? AND rev=?",g=[a._id,a._rev];d.executeSql(f,g,function(d,f){return f.rowsAffected?(e={ok:!0,id:a._id,rev:"0-0"},void(b.ctx&&c(null,e))):c(m(hd))})}"function"==typeof b&&(c=b,b={});var e;b.ctx?d(b.ctx):y.transaction(d,Ub(c),function(){e&&c(null,e)})},s._destroy=function(a,b){yc.Changes.removeAllListeners(s._name),y.transaction(function(a){var b=[Ie,Je,Ke,Me,Le,Ne];b.forEach(function(b){a.executeSql("DROP TABLE IF EXISTS "+b,[])})},Ub(b),function(){la()&&(delete window.localStorage["_pouch__websqldb_"+s._name],delete window.localStorage[s._name]),b(null,{ok:!0})})}}function zc(a,b,c){try{a.apply(b,c)}catch(d){"undefined"!=typeof PouchDB&&PouchDB.emit("error",d)}}function Ac(){if(!ef.running&&ef.queue.length){ef.running=!0;var a=ef.queue.shift();a.action(function(b,d){zc(a.callback,this,[b,d]),ef.running=!1,c.nextTick(Ac)})}}function Bc(a){return function(b){var c="unknown_error";b.target&&b.target.error&&(c=b.target.error.name||b.target.error.message),a(m(vd,c,b.type))}}function Cc(a,b,c){return{data:gc(a),winningRev:b,deletedOrLocal:c?"1":"0",seq:a.seq,id:a.id}}function Dc(a){if(!a)return null;var b=fc(a.data);return b.winningRev=a.winningRev,b.deleted="1"===a.deletedOrLocal,b.seq=a.seq,b}function Ec(a){if(!a)return a;var b=a._doc_id_rev.lastIndexOf(":");return a._id=a._doc_id_rev.substring(0,b-1),a._rev=a._doc_id_rev.substring(b+1),delete a._doc_id_rev,a}function Fc(a,b,c,d){c?d(a?"string"!=typeof a?a:Pa(a,b):e([""],{type:b})):a?"string"!=typeof a?Ra(a,function(a){d(Od(a))}):d(a):d("")}function Gc(a,b,c,d){function e(){++h===g.length&&d&&d()}function f(a,b){var d=a._attachments[b],f=d.digest,g=c.objectStore(_e).get(f);g.onsuccess=function(a){d.body=a.target.result.body,e()}}var g=Object.keys(a._attachments||{});if(!g.length)return d&&d();var h=0;g.forEach(function(c){b.attachments&&b.include_docs?f(a,c):(a._attachments[c].stub=!0,e())})}function Hc(a,b){return dd.all(a.map(function(a){if(a.doc&&a.doc._attachments){var c=Object.keys(a.doc._attachments);return dd.all(c.map(function(c){var d=a.doc._attachments[c];if("body"in d){var e=d.body,f=d.content_type;return new dd(function(g){Fc(e,f,b,function(b){a.doc._attachments[c]=Sc.extend(y(d,["digest","content_type"]),{data:b}),g()})})}}))}}))}function Ic(a,b,c){function d(){j--,j||e()}function e(){f.length&&f.forEach(function(a){var b=i.index("digestSeq").count(IDBKeyRange.bound(a+"::",a+"::",!1,!1));b.onsuccess=function(b){var c=b.target.result;c||h["delete"](a)}})}var f=[],g=c.objectStore($e),h=c.objectStore(_e),i=c.objectStore(af),j=a.length;a.forEach(function(a){var c=g.index("_doc_id_rev"),e=b+"::"+a;c.getKey(e).onsuccess=function(a){var b=a.target.result;if("number"!=typeof b)return d();g["delete"](b);var c=i.index("seq").openCursor(IDBKeyRange.only(b));c.onsuccess=function(a){var b=a.target.result;if(b){var c=b.value.digestSeq.split("::")[0];f.push(c),i["delete"](b.primaryKey),b["continue"]()}else d()}}})}function Jc(a,b,c){try{return{txn:a.transaction(b,c)}}catch(d){return{error:d}}}function Kc(a,b,c,d,e,f,g){function h(){var a=[Ze,$e,_e,bf,cf,af],b=Jc(e,a,"readwrite");return b.error?g(b.error):(u=b.txn,u.onabort=Bc(g),u.ontimeout=Bc(g),u.oncomplete=k,v=u.objectStore(Ze),w=u.objectStore($e),x=u.objectStore(_e),y=u.objectStore(af),void n(function(a){return a?(H=!0,g(a)):void j()}))}function i(){uc(a.revs_limit,A,d,G,u,F,o,c)}function j(){function a(){++c===A.length&&i()}function b(b){var c=Dc(b.target.result);c&&G.set(c.id,c),a()}if(A.length)for(var c=0,d=0,e=A.length;e>d;d++){var f=A[d];if(f._id&&P(f._id))a();else{var g=v.get(f.metadata.id);g.onsuccess=b}}}function k(){H||(f.notify(d._meta.name),d._meta.docCount+=B,g(null,F))}function l(a,b){var c=x.get(a);c.onsuccess=function(c){if(c.target.result)b();else{var d=m(Bd,"unknown stub attachment with digest "+a);d.status=412,b(d)}}}function n(a){function b(){++e===c.length&&a(d)}var c=[];if(A.forEach(function(a){a.data&&a.data._attachments&&Object.keys(a.data._attachments).forEach(function(b){var d=a.data._attachments[b];d.stub&&c.push(d.digest)})}),!c.length)return a();var d,e=0;c.forEach(function(a){l(a,function(a){a&&!d&&(d=a),b()})})}function o(a,b,c,d,e,f,g,h){B+=f,a.metadata.winningRev=b,a.metadata.deleted=c;var i=a.data;i._id=a.metadata.id,i._rev=a.metadata.rev,d&&(i._deleted=!0);var j=i._attachments&&Object.keys(i._attachments).length;return j?r(a,b,c,e,g,h):void q(a,b,c,e,g,h)}function p(a){var b=vc(a.metadata);Ic(b,a.metadata.id,u)}function q(a,b,c,e,f,g){function h(f){e&&d.auto_compaction&&p(a),l.seq=f.target.result,delete l.rev;var g=Cc(l,b,c),h=v.put(g);h.onsuccess=j}function i(a){a.preventDefault(),a.stopPropagation();var b=w.index("_doc_id_rev"),c=b.getKey(k._doc_id_rev);c.onsuccess=function(a){var b=w.put(k,a.target.result);b.onsuccess=h}}function j(){F[f]={ok:!0,id:l.id,rev:b},G.set(a.metadata.id,a.metadata),s(a,l.seq,g)}var k=a.data,l=a.metadata;k._doc_id_rev=l.id+"::"+l.rev,delete k._id,delete k._rev;var m=w.put(k);m.onsuccess=h,m.onerror=i}function r(a,b,c,d,e,f){function g(){j===k.length&&q(a,b,c,d,e,f)}function h(){j++,g()}var i=a.data,j=0,k=Object.keys(i._attachments);k.forEach(function(b){var c=a.data._attachments[b];if(c.stub)j++,g();else{var d=c.data;delete c.data;var e=c.digest;t(e,d,h)}})}function s(a,b,c){function d(){++f===g.length&&c()}function e(c){var e=a.data._attachments[c].digest,f=y.put({seq:b,digestSeq:e+"::"+b});f.onsuccess=d,f.onerror=function(a){a.preventDefault(),a.stopPropagation(),d()}}var f=0,g=Object.keys(a.data._attachments||{});if(!g.length)return c();for(var h=0;h<g.length;h++)e(g[h])}function t(a,b,c){var d=x.count(a);d.onsuccess=function(d){var e=d.target.result;if(e)return c();var f={digest:a,body:b},g=x.put(f);g.onsuccess=c}}for(var u,v,w,x,y,z,A=b.docs,B=0,C=0,D=A.length;D>C;C++){var E=A[C];E._id&&P(E._id)||(E=A[C]=X(E,c.new_edits),E.error&&!z&&(z=E))}if(z)return g(z);var F=new Array(A.length),G=new Vc.Map,H=!1,I=d._meta.blobSupport?"blob":"base64";hc(A,I,function(a){return a?g(a):void h()})}function Lc(a,b,c,d,e){try{if(a&&b)return e?IDBKeyRange.bound(b,a,!c,!1):IDBKeyRange.bound(a,b,!1,!c);if(a)return e?IDBKeyRange.upperBound(a):IDBKeyRange.lowerBound(a);if(b)return e?IDBKeyRange.lowerBound(b,!c):IDBKeyRange.upperBound(b,!c);if(d)return IDBKeyRange.only(d)}catch(f){return{error:f}}return null}function Mc(a,b,c,d){return"DataError"===c.name&&0===c.code?d(null,{total_rows:a._meta.docCount,offset:b.skip,rows:[]}):void d(m(vd,c.name,c.message))}function Nc(a,b,c,d){function e(a,d){function e(b,c,d){var e=b.id+"::"+d;x.get(e).onsuccess=function(d){c.doc=Ec(d.target.result),a.conflicts&&(c.doc._conflicts=L(b)),Gc(c.doc,a,t)}}function f(b,c,d){var f={id:d.id,key:d.id,value:{rev:c}},g=d.deleted;if("ok"===a.deleted)y.push(f),g?(f.value.deleted=!0,f.doc=null):a.include_docs&&e(d,f,c);else if(!g&&m--<=0&&(y.push(f),a.include_docs&&e(d,f,c),0===--n))return;b["continue"]()}function g(a){z=b._meta.docCount;var c=a.target.result;if(c){var d=Dc(c.value),e=d.winningRev;f(c,e,d)}}function h(){d(null,{total_rows:z,offset:a.skip,rows:y})}function i(){a.attachments?Hc(y,a.binary).then(h):h()}var j="startkey"in a?a.startkey:!1,k="endkey"in a?a.endkey:!1,l="key"in a?a.key:!1,m=a.skip||0,n="number"==typeof a.limit?a.limit:-1,o=a.inclusive_end!==!1,p="descending"in a&&a.descending?"prev":null,q=Lc(j,k,o,l,p);if(q&&q.error)return Mc(b,a,q.error,d);var r=[Ze,$e];a.attachments&&r.push(_e);var s=Jc(c,r,"readonly");if(s.error)return d(s.error);var t=s.txn,u=t.objectStore(Ze),v=t.objectStore($e),w=p?u.openCursor(q,p):u.openCursor(q),x=v.index("_doc_id_rev"),y=[],z=0;t.oncomplete=i,w.onsuccess=g}function f(a,c){return 0===a.limit?c(null,{total_rows:b._meta.docCount,offset:a.skip,rows:[]}):void e(a,c)}f(a,d)}function Oc(a){return new dd(function(b){var c=e([""]);a.objectStore(df).put(c,"key"),a.onabort=function(a){a.preventDefault(),a.stopPropagation(),b(!1)},a.oncomplete=function(){var a=navigator.userAgent.match(/Chrome\/(\d+)/),c=navigator.userAgent.match(/Edge\//);b(c||!a||parseInt(a[1],10)>=43)}})["catch"](function(){return!1})}function Pc(a,b){var c=this;ef.queue.push({action:function(b){Qc(c,a,b)},callback:b}),Ac()}function Qc(a,b,d){function e(a){var b=a.createObjectStore(Ze,{keyPath:"id"});a.createObjectStore($e,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),a.createObjectStore(_e,{keyPath:"digest"}),a.createObjectStore(bf,{keyPath:"id",autoIncrement:!1}),a.createObjectStore(df),b.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),a.createObjectStore(cf,{keyPath:"_id"});var c=a.createObjectStore(af,{autoIncrement:!0});c.createIndex("seq","seq"),c.createIndex("digestSeq","digestSeq",{unique:!0})}function f(a,b){var c=a.objectStore(Ze);c.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),c.openCursor().onsuccess=function(a){var d=a.target.result;if(d){var e=d.value,f=D(e);e.deletedOrLocal=f?"1":"0",c.put(e),d["continue"]()}else b()}}function g(a){a.createObjectStore(cf,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function h(a,b){var c=a.objectStore(cf),d=a.objectStore(Ze),e=a.objectStore($e),f=d.openCursor();f.onsuccess=function(a){var f=a.target.result;if(f){var g=f.value,h=g.id,i=P(h),j=B(g);if(i){var k=h+"::"+j,l=h+"::",m=h+"::~",n=e.index("_doc_id_rev"),o=IDBKeyRange.bound(l,m,!1,!1),p=n.openCursor(o);p.onsuccess=function(a){if(p=a.target.result){var b=p.value;b._doc_id_rev===k&&c.put(b),e["delete"](p.primaryKey),p["continue"]()}else d["delete"](f.primaryKey),f["continue"]()}}else f["continue"]()}else b&&b()}}function i(a){var b=a.createObjectStore(af,{autoIncrement:!0});b.createIndex("seq","seq"),b.createIndex("digestSeq","digestSeq",{unique:!0})}function j(a,b){var c=a.objectStore($e),d=a.objectStore(_e),e=a.objectStore(af),f=d.count();f.onsuccess=function(a){var d=a.target.result;return d?void(c.openCursor().onsuccess=function(a){var c=a.target.result;if(!c)return b();for(var d=c.value,f=c.primaryKey,g=Object.keys(d._attachments||{}),h={},i=0;i<g.length;i++){var j=d._attachments[g[i]];h[j.digest]=!0}var k=Object.keys(h);for(i=0;i<k.length;i++){var l=k[i];e.put({seq:f,digestSeq:l+"::"+f})}c["continue"]()}):b()}}function k(a){function b(a){return a.data?Dc(a):(a.deleted="1"===a.deletedOrLocal,a)}var c=a.objectStore($e),d=a.objectStore(Ze),e=d.openCursor();e.onsuccess=function(a){function e(){var a=h.id+"::",b=h.id+"::",d=c.index("_doc_id_rev").openCursor(IDBKeyRange.bound(a,b)),e=0;d.onsuccess=function(a){var b=a.target.result;if(!b)return h.seq=e,f();var c=b.primaryKey;c>e&&(e=c),b["continue"]()}}function f(){var a=Cc(h,h.winningRev,h.deleted),b=d.put(a);b.onsuccess=function(){g["continue"]()}}var g=a.target.result;if(g){var h=b(g.value);return h.winningRev=h.winningRev||B(h),h.seq?f():void e()}}}var l=b.name,n=null;a._meta=null,a.type=function(){return"idb"},a._id=w(function(b){b(null,a._meta.instanceId)}),a._bulkDocs=function(c,d,e){Kc(b,c,d,a,n,Pc.Changes,e)},a._get=function(a,b,c){function d(){c(g,{doc:e,metadata:f,ctx:h})}var e,f,g,h=b.ctx;if(!h){var i=Jc(n,[Ze,$e,_e],"readonly");if(i.error)return c(i.error);h=i.txn}h.objectStore(Ze).get(a).onsuccess=function(a){if(f=Dc(a.target.result),!f)return g=m(hd,"missing"),d();if(D(f)&&!b.rev)return g=m(hd,"deleted"),d();var c=h.objectStore($e),i=b.rev||f.winningRev,j=f.id+"::"+i;c.index("_doc_id_rev").get(j).onsuccess=function(a){return e=a.target.result,e&&(e=Ec(e)),e?void d():(g=m(hd,"missing"),d())}}},a._getAttachment=function(a,b,c){var d;if(b.ctx)d=b.ctx;else{var e=Jc(n,[Ze,$e,_e],"readonly");if(e.error)return c(e.error);d=e.txn}var f=a.digest,g=a.content_type;d.objectStore(_e).get(f).onsuccess=function(a){var d=a.target.result.body;Fc(d,g,b.binary,function(a){c(null,a)})}},a._info=function(b){if(null===n||!ff[l]){var c=new Error("db isn't open");return c.id="idbNull",b(c)}var d,e,f=Jc(n,[$e],"readonly");if(f.error)return b(f.error);var g=f.txn,h=g.objectStore($e).openCursor(null,"prev");h.onsuccess=function(b){var c=b.target.result;d=c?c.key:0,e=a._meta.docCount},g.oncomplete=function(){b(null,{doc_count:e,update_seq:d,idb_attachment_format:a._meta.blobSupport?"binary":"base64"})}},a._allDocs=function(b,c){Nc(b,a,n,c)},a._changes=function(b){function c(a){function c(){return l.seq!==g?a["continue"]():(i=g,l.winningRev===f._rev?e(f):void d())}function d(){var a=f._id+"::"+l.winningRev,b=q.get(a);b.onsuccess=function(a){e(Ec(a.target.result))}}function e(c){var d=b.processChange(c,l,b);d.seq=l.seq;var e=u(d);return"object"==typeof e?b.complete(e):(e&&(t++,k&&s.push(d),b.attachments&&b.include_docs?Gc(c,b,m,function(){Hc([d],b.binary).then(function(){b.onChange(d)})}):b.onChange(d)),void(t!==j&&a["continue"]()))}var f=Ec(a.value),g=a.key;if(h&&!h.has(f._id))return a["continue"]();var l;return(l=v.get(f._id))?c():void(p.get(f._id).onsuccess=function(a){l=Dc(a.target.result),v.set(f._id,l),c()})}function d(a){var b=a.target.result;b&&c(b)}function e(){var a=[Ze,$e];b.attachments&&a.push(_e);var c=Jc(n,a,"readonly");if(c.error)return b.complete(c.error);m=c.txn,m.onabort=Bc(b.complete),m.oncomplete=f,o=m.objectStore($e),p=m.objectStore(Ze),q=o.index("_doc_id_rev");var e;e=b.descending?o.openCursor(null,"prev"):o.openCursor(IDBKeyRange.lowerBound(b.since,!0)),e.onsuccess=d}function f(){function a(){b.complete(null,{results:s,last_seq:i})}!b.continuous&&b.attachments?Hc(s).then(a):a()}if(b=r(b),b.continuous){var g=l+":"+S();return Pc.Changes.addListener(l,g,a,b),Pc.Changes.notify(l),{cancel:function(){Pc.Changes.removeListener(l,g)}}}var h=b.doc_ids&&new Vc.Set(b.doc_ids);b.since=b.since||0;var i=b.since,j="limit"in b?b.limit:-1;0===j&&(j=1);var k;k="return_docs"in b?b.return_docs:"returnDocs"in b?b.returnDocs:!0;var m,o,p,q,s=[],t=0,u=ra(b),v=new Vc.Map;e()},a._close=function(a){return null===n?a(m(md)):(n.close(),delete ff[l],n=null,void a())},a._getRevisionTree=function(a,b){var c=Jc(n,[Ze],"readonly");if(c.error)return b(c.error);var d=c.txn,e=d.objectStore(Ze).get(a);e.onsuccess=function(a){var c=Dc(a.target.result);c?b(null,c.rev_tree):b(m(hd))}},a._doCompaction=function(a,b,c){var d=[Ze,$e,_e,af],e=Jc(n,d,"readwrite");if(e.error)return c(e.error);var f=e.txn,g=f.objectStore(Ze);g.get(a).onsuccess=function(c){var d=Dc(c.target.result);I(d.rev_tree,function(a,c,d,e,f){var g=c+"-"+d;-1!==b.indexOf(g)&&(f.status="missing")}),Ic(b,a,f);var e=d.winningRev,g=d.deleted;f.objectStore(Ze).put(Cc(d,e,g))},f.onabort=Bc(c),f.oncomplete=function(){c()}},a._getLocal=function(a,b){var c=Jc(n,[cf],"readonly");if(c.error)return b(c.error);var d=c.txn,e=d.objectStore(cf).get(a);e.onerror=Bc(b),e.onsuccess=function(a){var c=a.target.result;c?(delete c._doc_id_rev,b(null,c)):b(m(hd))}},a._putLocal=function(a,b,c){"function"==typeof b&&(c=b,b={}),delete a._revisions;var d=a._rev,e=a._id;d?a._rev="0-"+(parseInt(d.split("-")[1],10)+1):a._rev="0-1";var f,g=b.ctx;if(!g){var h=Jc(n,[cf],"readwrite");if(h.error)return c(h.error);g=h.txn,g.onerror=Bc(c),g.oncomplete=function(){f&&c(null,f)}}var i,j=g.objectStore(cf);d?(i=j.get(e),i.onsuccess=function(e){var g=e.target.result;if(g&&g._rev===d){var h=j.put(a);h.onsuccess=function(){f={ok:!0,id:a._id,rev:a._rev},b.ctx&&c(null,f)}}else c(m(id))}):(i=j.add(a),i.onerror=function(a){c(m(id)),a.preventDefault(),a.stopPropagation()},i.onsuccess=function(){f={ok:!0,id:a._id,rev:a._rev},b.ctx&&c(null,f)})},a._removeLocal=function(a,b,c){"function"==typeof b&&(c=b,b={});var d=b.ctx;if(!d){var e=Jc(n,[cf],"readwrite");if(e.error)return c(e.error);d=e.txn,d.oncomplete=function(){f&&c(null,f)}}var f,g=a._id,h=d.objectStore(cf),i=h.get(g);i.onerror=Bc(c),i.onsuccess=function(d){var e=d.target.result;e&&e._rev===a._rev?(h["delete"](g),f={ok:!0,id:g,rev:"0-0"},b.ctx&&c(null,f)):c(m(hd))}},a._destroy=function(a,b){Pc.Changes.removeAllListeners(l),Pc.openReqList[l]&&Pc.openReqList[l].result&&(Pc.openReqList[l].result.close(),delete ff[l]);var c=indexedDB.deleteDatabase(l);c.onsuccess=function(){Pc.openReqList[l]&&(Pc.openReqList[l]=null),la()&&l in localStorage&&delete localStorage[l],b(null,{ok:!0})},c.onerror=Bc(b)};var o=ff[l];if(o)return n=o.idb,a._meta=o.global,void c.nextTick(function(){d(null,a)});var p;p=b.storage?Rc(l,b.storage):indexedDB.open(l,Ye),"openReqList"in Pc||(Pc.openReqList={}),Pc.openReqList[l]=p,p.onupgradeneeded=function(a){function b(){var a=l[m-1];m++,a&&a(d,b)}var c=a.target.result;if(a.oldVersion<1)return e(c);var d=a.currentTarget.transaction;a.oldVersion<3&&g(c),a.oldVersion<4&&i(c);var l=[f,h,j,k],m=a.oldVersion;b()},p.onsuccess=function(b){n=b.target.result,n.onversionchange=function(){n.close(),delete ff[l]},n.onabort=function(a){console.error("Database has a global failure",a.target.error),n.close(),delete ff[l]};var c=n.transaction([bf,df,Ze],"readwrite"),e=c.objectStore(bf).get(bf),f=null,g=null,h=null;e.onsuccess=function(b){var e=function(){null!==f&&null!==g&&null!==h&&(a._meta={name:l,instanceId:h,blobSupport:f,docCount:g},ff[l]={idb:n,global:a._meta},d(null,a))},i=b.target.result||{id:bf};l+"_id"in i?(h=i[l+"_id"],e()):(h=S(),i[l+"_id"]=h,c.objectStore(bf).put(i).onsuccess=function(){e()}),Xe||(Xe=Oc(c)),Xe.then(function(a){f=a,e()});var j=c.objectStore(Ze).index("deletedOrLocal");j.count(IDBKeyRange.only("0")).onsuccess=function(a){g=a.target.result,e()}}},p.onerror=function(a){var b="Failed to open indexedDB, are you in private browsing mode?";console.error(b),d(m(vd,b))}}function Rc(a,b){try{return indexedDB.open(a,{version:Ye,storage:b})}catch(c){return indexedDB.open(a,Ye)}}var Sc=a(7),Tc="default"in Sc?Sc["default"]:Sc,Uc=a(6);Uc="default"in Uc?Uc["default"]:Uc;var Vc=a(12);Vc="default"in Vc?Vc["default"]:Vc;var Wc=a(4),Xc=a(1);Xc="default"in Xc?Xc["default"]:Xc;var Yc=a(2);Yc="default"in Yc?Yc["default"]:Yc;var Zc=a(10),$c="default"in Zc?Zc["default"]:Zc,_c=a(8);_c="default"in _c?_c["default"]:_c;var ad=a(14);ad="default"in ad?ad["default"]:ad;var bd=a(15);bd="default"in bd?bd["default"]:bd;var cd=a(16);cd="default"in cd?cd["default"]:cd;var dd="function"==typeof Promise?Promise:_c,ed=j();Uc(l,Error),l.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var fd=new l({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),gd=new l({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),hd=new l({status:404,error:"not_found",reason:"missing"}),id=new l({status:409,error:"conflict",reason:"Document update conflict"}),jd=new l({status:400,error:"invalid_id",reason:"_id field must contain a string"}),kd=new l({status:412,error:"missing_id",reason:"_id is required for puts"}),ld=new l({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),md=new l({status:412,error:"precondition_failed",reason:"Database not open"}),nd=new l({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),od=new l({status:500,error:"badarg",reason:"Some query argument is invalid"}),pd=new l({status:400,error:"invalid_request",reason:"Request was invalid"}),qd=new l({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),rd=new l({status:500,error:"doc_validation",reason:"Bad special document member"}),sd=new l({status:400,error:"bad_request",reason:"Something wrong with the request"}),td=new l({status:400,error:"bad_request",reason:"Document must be a JSON object"}),ud=new l({status:404,error:"not_found",reason:"Database not found"}),vd=new l({status:500,error:"indexed_db_went_bad",reason:"unknown"}),wd=new l({status:500,error:"web_sql_went_bad",reason:"unknown"}),xd=new l({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),yd=new l({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),zd=new l({status:400,error:"bad_request",reason:"Invalid rev format"}),Ad=new l({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),Bd=new l({status:412,error:"missing_stub"}),Cd=new l({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),Dd={UNAUTHORIZED:fd,MISSING_BULK_DOCS:gd,MISSING_DOC:hd,REV_CONFLICT:id,INVALID_ID:jd,MISSING_ID:kd,RESERVED_ID:ld,NOT_OPEN:md,UNKNOWN_ERROR:nd,BAD_ARG:od,INVALID_REQUEST:pd,QUERY_PARSE_ERROR:qd,DOC_VALIDATION:rd,BAD_REQUEST:sd,NOT_AN_OBJECT:td,DB_MISSING:ud,WSQ_ERROR:wd,LDB_ERROR:xd,FORBIDDEN:yd,INVALID_REV:zd,FILE_EXISTS:Ad,MISSING_STUB:Bd,IDB_ERROR:vd,INVALID_URL:Cd},Ed=function(a,b,c){var d=Object.keys(Dd).filter(function(c){var d=Dd[c];return"function"!=typeof d&&d[a]===b}),e=c&&d.filter(function(a){var b=Dd[a];return b.message===c})[0]||d[0];return e?Dd[e]:null},Fd=function(){},Gd=Yc("pouchdb:api");Uc(M,Wc.EventEmitter),M.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},M.prototype.doChanges=function(a){var b=this,c=a.complete;if(a=r(a),"live"in a&&!("continuous"in a)&&(a.continuous=a.live),a.processChange=N,"latest"===a.since&&(a.since="now"),a.since||(a.since=0),"now"===a.since)return void this.db.info().then(function(d){return b.isCancelled?void c(null,{status:"cancelled"}):(a.since=d.update_seq,void b.doChanges(a))},c);if(a.continuous&&"now"!==a.since&&this.db.info().then(function(a){b.startSeq=a.update_seq},function(a){if("idbNull"!==a.id)throw a}),a.filter&&"string"==typeof a.filter&&("_view"===a.filter?a.view=H(a.view):a.filter=H(a.filter),"http"!==this.db.type()&&!a.doc_ids))return this.filterChanges(a);"descending"in a||(a.descending=!1),a.limit=0===a.limit?1:a.limit,a.complete=c;var d=this.db._changes(a);if(d&&"function"==typeof d.cancel){var e=b.cancel;b.cancel=Xc(function(a){d.cancel(),e.apply(this,a)})}},M.prototype.filterChanges=function(a){var b=this,c=a.complete;if("_view"===a.filter){if(!a.view||"string"!=typeof a.view){var d=m(sd,"`view` filter parameter not found or invalid.");return c(d)}var e=G(a.view);this.db.get("_design/"+e[0],function(d,f){if(b.isCancelled)return c(null,{status:"cancelled"});if(d)return c(n(d));var g=f&&f.views&&f.views[e[1]]&&f.views[e[1]].map;return g?(a.filter=F(g),void b.doChanges(a)):c(m(hd,f.views?"missing json key: "+e[1]:"missing json key: views"))})}else{var f=G(a.filter);if(!f)return b.doChanges(a);this.db.get("_design/"+f[0],function(d,e){if(b.isCancelled)return c(null,{status:"cancelled"});if(d)return c(n(d));var g=e&&e.filters&&e.filters[f[1]];return g?(a.filter=E(g),void b.doChanges(a)):c(m(hd,e&&e.filters?"missing json key: "+f[1]:"missing json key: filters"))})}};var Hd="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Id=T(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Jd=T(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);Uc(fa,Wc.EventEmitter),fa.prototype.post=x("post",function(a,b,c){return"function"==typeof b&&(c=b,b={}),"object"!=typeof a||Array.isArray(a)?c(m(td)):void this.bulkDocs({docs:[a]},b,$(c))}),fa.prototype.put=x("put",Xc(function(a){var b,c,d,e,f=a.shift(),g="_id"in f;if("object"!=typeof f||Array.isArray(f))return(e=a.pop())(m(td));for(;b=a.shift(),c=typeof b,"string"!==c||g?"string"!==c||!g||"_rev"in f?"object"===c?d=b:"function"===c&&(e=b):f._rev=b:(f._id=b,g=!0),a.length;);return d=d||{},U(f._id),P(f._id)&&"function"==typeof this._putLocal?f._deleted?this._removeLocal(f,e):this._putLocal(f,e):void this.bulkDocs({docs:[f]},d,$(e))})),fa.prototype.putAttachment=x("putAttachment",function(a,b,c,d,e,f){function g(a){return a._attachments=a._attachments||{},a._attachments[b]={content_type:e,data:d},h.put(a)}var h=this;return"function"==typeof e&&(f=e,e=d,d=c,c=null),"undefined"==typeof e&&(e=d,d=c,c=null),h.get(a).then(function(a){if(a._rev!==c)throw m(id);return g(a)},function(b){if(b.reason===hd.message)return g({_id:a});throw b})}),fa.prototype.removeAttachment=x("removeAttachment",function(a,b,c,d){var e=this;e.get(a,function(a,f){return a?void d(a):f._rev!==c?void d(m(id)):f._attachments?(delete f._attachments[b],0===Object.keys(f._attachments).length&&delete f._attachments,void e.put(f,d)):d()})}),fa.prototype.remove=x("remove",function(a,b,c,d){var e;"string"==typeof b?(e={_id:a,_rev:b},"function"==typeof c&&(d=c,c={})):(e=a,"function"==typeof b?(d=b,c={}):(d=c,c=b)),c=c||{},c.was_delete=!0;var f={_id:e._id,_rev:e._rev||c.rev};return f._deleted=!0,P(f._id)&&"function"==typeof this._removeLocal?this._removeLocal(e,d):void this.bulkDocs({docs:[f]},c,$(d))}),fa.prototype.revsDiff=x("revsDiff",function(a,b,c){function d(a,b){h.has(a)||h.set(a,{missing:[]}),h.get(a).missing.push(b)}function e(b,c){var e=a[b].slice(0);I(c,function(a,c,f,g,h){var i=c+"-"+f,j=e.indexOf(i);-1!==j&&(e.splice(j,1),"available"!==h.status&&d(b,i))}),e.forEach(function(a){d(b,a)})}"function"==typeof b&&(c=b,b={});var f=Object.keys(a);if(!f.length)return c(null,{});var g=0,h=new Vc.Map;f.map(function(b){this._getRevisionTree(b,function(d,i){if(d&&404===d.status&&"missing"===d.message)h.set(b,{missing:a[b]});else{if(d)return c(d);e(b,i)}if(++g===f.length){var j={};return h.forEach(function(a,b){j[b]=a}),c(null,j)}})},this)}),fa.prototype.bulkGet=x("bulkGet",function(a,b){O(this,a,b)}),fa.prototype.compactDocument=x("compactDocument",function(a,b,c){var d=this;this._getRevisionTree(a,function(e,f){if(e)return c(e);var g=ba(f),h=[],i=[];Object.keys(g).forEach(function(a){g[a]>b&&h.push(a)}),I(f,function(a,b,c,d,e){var f=b+"-"+c;"available"===e.status&&-1!==h.indexOf(f)&&i.push(f)}),d._doCompaction(a,i,c)})}),fa.prototype.compact=x("compact",function(a,b){"function"==typeof a&&(b=a,a={});var c=this;a=a||{},c._compactionQueue=c._compactionQueue||[],c._compactionQueue.push({opts:a,callback:b}),1===c._compactionQueue.length&&da(c)}),fa.prototype._compact=function(a,b){function c(a){g.push(e.compactDocument(a.id,0))}function d(a){var c=a.last_seq;dd.all(g).then(function(){return z(e,"_local/compaction",function(a){return!a.last_seq||a.last_seq<c?(a.last_seq=c,a):!1})}).then(function(){b(null,{ok:!0})})["catch"](b)}var e=this,f={return_docs:!1,last_seq:a.last_seq||0},g=[];e.changes(f).on("change",c).on("complete",d).on("error",b)},fa.prototype.get=x("get",function(a,b,c){function d(){var d=[],g=e.length;return g?void e.forEach(function(e){f.get(a,{rev:e,revs:b.revs,attachments:b.attachments},function(a,b){
a?d.push({missing:e}):d.push({ok:b}),g--,g||c(null,d)})}):c(null,d)}if("function"==typeof b&&(c=b,b={}),"string"!=typeof a)return c(m(jd));if(P(a)&&"function"==typeof this._getLocal)return this._getLocal(a,c);var e=[],f=this;if(!b.open_revs)return this._get(a,b,function(a,d){if(a)return c(a);var e=d.doc,g=d.metadata,h=d.ctx;if(b.conflicts){var i=L(g);i.length&&(e._conflicts=i)}if(D(g,e._rev)&&(e._deleted=!0),b.revs||b.revs_info){var j=Q(g.rev_tree),k=Z(j,function(a){return-1!==a.ids.map(function(a){return a.id}).indexOf(e._rev.split("-")[1])}),l=k.ids.map(function(a){return a.id}).indexOf(e._rev.split("-")[1])+1,m=k.ids.length-l;if(k.ids.splice(l,m),k.ids.reverse(),b.revs&&(e._revisions={start:k.pos+k.ids.length-1,ids:k.ids.map(function(a){return a.id})}),b.revs_info){var n=k.pos+k.ids.length;e._revs_info=k.ids.map(function(a){return n--,{rev:n+"-"+a.id,status:a.opts.status}})}}if(b.attachments&&e._attachments){var o=e._attachments,p=Object.keys(o).length;if(0===p)return c(null,e);Object.keys(o).forEach(function(a){this._getAttachment(o[a],{binary:b.binary,ctx:h},function(b,d){var f=e._attachments[a];f.data=d,delete f.stub,delete f.length,--p||c(null,e)})},f)}else{if(e._attachments)for(var q in e._attachments)e._attachments.hasOwnProperty(q)&&(e._attachments[q].stub=!0);c(null,e)}});if("all"===b.open_revs)this._getRevisionTree(a,function(a,b){return a?c(a):(e=K(b).map(function(a){return a.rev}),void d())});else{if(!Array.isArray(b.open_revs))return c(m(nd,"function_clause"));e=b.open_revs;for(var g=0;g<e.length;g++){var h=e[g];if("string"!=typeof h||!/^\d+-/.test(h))return c(m(zd))}d()}}),fa.prototype.getAttachment=x("getAttachment",function(a,b,c,d){var e=this;c instanceof Function&&(d=c,c={}),this._get(a,c,function(a,f){return a?d(a):f.doc._attachments&&f.doc._attachments[b]?(c.ctx=f.ctx,c.binary=!0,void e._getAttachment(f.doc._attachments[b],c,d)):d(m(hd))})}),fa.prototype.allDocs=x("allDocs",function(a,b){if("function"==typeof a&&(b=a,a={}),a.skip="undefined"!=typeof a.skip?a.skip:0,a.start_key&&(a.startkey=a.start_key),a.end_key&&(a.endkey=a.end_key),"keys"in a){if(!Array.isArray(a.keys))return b(new TypeError("options.keys must be an array"));var c=["startkey","endkey","key"].filter(function(b){return b in a})[0];if(c)return void b(m(qd,"Query parameter `"+c+"` is not compatible with multi-get"));if("http"!==this.type())return ca(this,a,b)}return this._allDocs(a,b)}),fa.prototype.changes=function(a,b){return"function"==typeof a&&(b=a,a={}),new M(this,a,b)},fa.prototype.close=x("close",function(a){return this._closed=!0,this._close(a)}),fa.prototype.info=x("info",function(a){var b=this;this._info(function(c,d){return c?a(c):(d.db_name=d.db_name||b._db_name,d.auto_compaction=!(!b.auto_compaction||"http"===b.type()),d.adapter=b.type(),void a(null,d))})}),fa.prototype.id=x("id",function(a){return this._id(a)}),fa.prototype.bulkDocs=x("bulkDocs",function(a,b,c){if("function"==typeof b&&(c=b,b={}),b=b||{},Array.isArray(a)&&(a={docs:a}),!a||!a.docs||!Array.isArray(a.docs))return c(m(gd));for(var d=0;d<a.docs.length;++d)if("object"!=typeof a.docs[d]||Array.isArray(a.docs[d]))return c(m(td));var e;return a.docs.forEach(function(a){a._attachments&&Object.keys(a._attachments).forEach(function(a){e=e||ea(a)})}),e?c(m(sd,e)):("new_edits"in b||("new_edits"in a?b.new_edits=a.new_edits:b.new_edits=!0),b.new_edits||"http"===this.type()||a.docs.sort(aa),_(a.docs),this._bulkDocs(a,b,function(a,d){return a?c(a):(b.new_edits||(d=d.filter(function(a){return a.error})),void c(null,d))}))}),fa.prototype.registerDependentDatabase=x("registerDependentDatabase",function(a,b){function c(b){return b.dependentDbs=b.dependentDbs||{},b.dependentDbs[a]?!1:(b.dependentDbs[a]=!0,b)}var d=new this.constructor(a,this.__opts);z(this,"_local/_pouch_dependentDbs",c).then(function(){b(null,{db:d})})["catch"](b)}),fa.prototype.destroy=x("destroy",function(a,b){function c(){d._destroy(a,function(a,c){return a?b(a):(d.emit("destroyed"),void b(null,c||{ok:!0}))})}"function"==typeof a&&(b=a,a={});var d=this,e="use_prefix"in d?d.use_prefix:!0;return"http"===d.type()?c():void d.get("_local/_pouch_dependentDbs",function(a,f){if(a)return 404!==a.status?b(a):c();var g=f.dependentDbs,h=d.constructor,i=Object.keys(g).map(function(a){var b=e?a.replace(new RegExp("^"+h.prefix),""):a;return new h(b,d.__opts).destroy()});dd.all(i).then(c,b)})}),ga.prototype.execute=function(){var a;if(this.failed)for(;a=this.queue.shift();)a(this.failed);else for(;a=this.queue.shift();)a()},ga.prototype.fail=function(a){this.failed=a,this.execute()},ga.prototype.ready=function(a){this.isReady=!0,this.db=a,this.execute()},ga.prototype.addTask=function(a){this.queue.push(a),this.failed&&this.execute()},Uc(ja,fa),ja.debug=Yc;var Kd;if(ka())Kd=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),Kd=!!localStorage.getItem("_pouch_check_localstorage")}catch(Ld){Kd=!1}ja.adapters={},ja.preferredAdapters=[],ja.prefix="_pouch_";var Md=new Wc.EventEmitter;ma(ja),ja.parseAdapter=function(a,b){var c,d,e=a.match(/([a-z\-]*):\/\/(.*)/);if(e){if(a=/http(s?)/.test(e[1])?e[1]+"://"+e[2]:e[2],c=e[1],!ja.adapters[c].valid())throw"Invalid adapter";return{name:a,adapter:e[1]}}var f="idb"in ja.adapters&&"websql"in ja.adapters&&la()&&localStorage["_pouch__websqldb_"+ja.prefix+a];if(b.adapter)d=b.adapter;else if("undefined"!=typeof b&&b.db)d="leveldb";else for(var g=0;g<ja.preferredAdapters.length;++g)if(d=ja.preferredAdapters[g],d in ja.adapters){if(f&&"idb"===d){console.log('PouchDB is downgrading "'+a+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}c=ja.adapters[d];var h=c&&"use_prefix"in c?c.use_prefix:!0;return{name:h?ja.prefix+a:a,adapter:d}},ja.adapter=function(a,b,c){b.valid()&&(ja.adapters[a]=b,c&&ja.preferredAdapters.push(a))},ja.plugin=function(a){return Object.keys(a).forEach(function(b){ja.prototype[b]=a[b]}),ja},ja.defaults=function(a){function b(c,d,e){return this instanceof b?(("function"==typeof d||"undefined"==typeof d)&&(e=d,d={}),c&&"object"==typeof c&&(d=c,c=void 0),d=Sc.extend({},a,d),void ja.call(this,c,d,e)):new b(c,d,e)}return Uc(b,ja),ma(b),b.preferredAdapters=ja.preferredAdapters.slice(),Object.keys(ja).forEach(function(a){a in b||(b[a]=ja[a])}),b};var Nd=function(a){return atob(a)},Od=function(a){return btoa(a)},Pd=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Qd="queryKey",Rd=/(?:^|&)([^&=]*)=?([^&]*)/g,Sd=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Td=Tc.extend,Ud={ajax:u,parseUri:pa,uuid:S,Promise:dd,atob:Nd,btoa:Od,binaryStringToBlobOrBuffer:oa,clone:r,extend:Td,createError:m},Vd=$c.collate,Wd=1,Xd="pouchdb",Yd=5,Zd=0;ua.prototype.writeCheckpoint=function(a,b){var c=this;return this.updateTarget(a,b).then(function(){return c.updateSource(a,b)})},ua.prototype.updateTarget=function(a,b){return ta(this.target,this.id,a,b,this.returnValue)},ua.prototype.updateSource=function(a,b){var c=this;return this.readOnlySource?dd.resolve(!0):ta(this.src,this.id,a,b,this.returnValue)["catch"](function(a){var b="number"==typeof a.status&&4===Math.floor(a.status/100);if(b)return c.readOnlySource=!0,!0;throw a})};var $d={undefined:function(a,b){return 0===Vd(a.last_seq,b.last_seq)?b.last_seq:0},1:function(a,b){return va(b,a).last_seq}};ua.prototype.getCheckpoint=function(){var a=this;return a.target.get(a.id).then(function(b){return a.src.get(a.id).then(function(a){if(b.version!==a.version)return Zd;var c;return c=b.version?b.version.toString():"undefined",c in $d?$d[c](b,a):Zd},function(c){if(404===c.status&&b.last_seq)return a.src.put({_id:a.id,last_seq:Zd}).then(function(){return Zd},function(c){return 401===c.status?(a.readOnlySource=!0,b.last_seq):Zd});throw c})})["catch"](function(a){if(404!==a.status)throw a;return Zd})};var _d=0,ae=d.setImmediate||d.setTimeout,be=32768,ce=w(function(a,b){function c(){var d=h*f,e=d+f;if(h++,g>h)j(i,a,d,e),ae(c);else{j(i,a,d,e);var k=i.end(!0),l=Ba(k);b(null,l),i.destroy()}}var d="string"==typeof a,e=d?a.length:a.byteLength,f=Math.min(be,e),g=Math.ceil(e/f),h=0,i=d?new bd:new bd.ArrayBuffer,j=d?Da:Ca;c()});Uc(Ka,Wc.EventEmitter),Ka.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Ka.prototype.ready=function(a,b){function c(){e.cancel()}function d(){a.removeListener("destroyed",c),b.removeListener("destroyed",c)}var e=this;e._readyCalled||(e._readyCalled=!0,a.once("destroyed",c),b.once("destroyed",c),e.once("complete",d))};var de={replicate:Ma,toPouch:La},ee=de.replicate;Uc(Oa,Wc.EventEmitter),Oa.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};var fe=25,ge=50,he={},ie=1800,je=Yc("pouchdb:http");_a.valid=function(){return!0};var ke=function(a,b){return b&&a.then(function(a){c.nextTick(function(){b(null,a)})},function(a){c.nextTick(function(){b(a)})}),a},le=function(a){return Xc(function(b){var c=b.pop(),d=a.apply(this,b);return"function"==typeof c&&ke(d,c),d})},me=function(a,b){return a.then(function(a){return b().then(function(){return a})},function(a){return b().then(function(){throw a})})},ne=function(a,b){return function(){var c=arguments,d=this;return a.add(function(){return b.apply(d,c)})}},oe=function(a){for(var b={},c=0,d=a.length;d>c;c++)b["$"+a[c]]=!0;var e=Object.keys(b),f=new Array(e.length);for(c=0,d=e.length;d>c;c++)f[c]=e[c].substring(1);return f},pe={uniq:oe,sequentialize:ne,fin:me,callbackify:le,promisedCallback:ke};ab.prototype.add=function(a){return this.promise=this.promise["catch"](function(){}).then(function(){return a()}),this.promise},ab.prototype.finish=function(){return this.promise};var qe,re=$c.collate,se=$c.toIndexableString,te=$c.normalizeKey,ue=$c.parseIndexableString;qe="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var ve=pe.callbackify,we=pe.sequentialize,xe=pe.uniq,ye=pe.fin,ze=pe.promisedCallback,Ae={},Be=new ab,Ce=50,De={_sum:function(a,b){return ob(b)},_count:function(a,b){return b.length},_stats:function(a,b){function c(a){for(var b=0,c=0,d=a.length;d>c;c++){var e=a[c];b+=e*e}return b}return{sum:ob(b),min:Math.min.apply(null,b),max:Math.max.apply(null,b),count:b.length,sumsqr:c(b)}}},Ee=ve(function(){var a=this;return"http"===a.type()?Gb(a):"function"==typeof a._viewCleanup?wb(a):Hb(a)}),Fe=function(a,b,c){"function"==typeof b&&(c=b,b={}),b=b?rb(b):{},"function"==typeof a&&(a={map:a});var d=this,e=dd.resolve().then(function(){return Ib(d,a,b)});return ze(e,c),e};Uc(Jb,Error),Uc(Kb,Error),Uc(Lb,Error);var Ge={query:Fe,viewCleanup:Ee},He=7,Ie=Mb("document-store"),Je=Mb("by-sequence"),Ke=Mb("attach-store"),Le=Mb("local-store"),Me=Mb("metadata-store"),Ne=Mb("attach-seq-store"),Oe={};Uc(_b,Wc.EventEmitter),_b.prototype.addListener=function(a,b,c,d){function e(){function a(){g=!1}if(f._listeners[b]){if(g)return void(g="waiting");g=!0;var h=y(d,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);c.changes(h).on("change",function(a){a.seq>d.since&&!d.cancelled&&(d.since=a.seq,d.onChange(a))}).on("complete",function(){"waiting"===g&&setTimeout(function(){e()},0),g=!1}).on("error",a)}}if(!this._listeners[b]){var f=this,g=!1;this._listeners[b]=e,this.on(a,e)}},_b.prototype.removeListener=function(a,b){b in this._listeners&&Wc.EventEmitter.prototype.removeListener.call(this,a,this._listeners[b])},_b.prototype.notifyLocalWindows=function(a){ka()?chrome.storage.local.set({dbName:a}):la()&&(localStorage[a]="a"===localStorage[a]?"b":"a")},_b.prototype.notify=function(a){this.emit(a),this.notifyLocalWindows(a)};var Pe=1,Qe="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+Je+" (seq, deleted)",Re="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+Je+" (doc_id, rev)",Se="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+Ie+" (winningseq)",Te="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+Ne+" (seq)",Ue="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+Ne+" (digest, seq)",Ve=Je+".seq = "+Ie+".winningseq",We=Je+".seq AS seq, "+Je+".deleted AS deleted, "+Je+".json AS data, "+Je+".rev AS rev, "+Ie+".json AS metadata";yc.valid=Zb,yc.Changes=new _b;var Xe,Ye=5,Ze="document-store",$e="by-sequence",_e="attach-store",af="attach-seq-store",bf="meta-store",cf="local-store",df="detect-blob-support",ef={running:!1,queue:[]},ff={};Pc.valid=function(){var a="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return!a&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange},Pc.Changes=new _b;var gf={idb:Pc,websql:yc};ja.ajax=u,ja.utils=Ud,ja.Errors=Dd,ja.replicate=de.replicate,ja.sync=Na,ja.version="5.2.0",ja.adapter("http",_a),ja.adapter("https",_a),ja.plugin(Ge),Object.keys(gf).forEach(function(a){ja.adapter(a,gf[a],!0)}),b.exports=ja}).call(this,a(13),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,13:13,14:14,15:15,16:16,2:2,4:4,6:6,7:7,8:8}]},{},[17])(17)}),angular.module("gmitcat").service("auth",["$location",function(a){var b=!1;return{setUser:function(a){b=a},isLoggedIn:function(){return b?b:!1},logout:function(){b=!1,console.log("logging out"),a.path("/login")}}}]),angular.module("gmitcat").controller("HomeCtrl",["auth",function(a){function b(){a.logout()}var c=this;c.logout=b}]),angular.module("gmitcat").controller("LoginCtrl",["$timeout","$rootScope","auth","detailsService","$location",function(a,b,c,d,e){function f(f){g.user=d.user,g.user.username==f.username&&g.user.password==f.password?(b.isLoggedOut=!1,c.setUser(!0),console.log("Login Successful!"),e.path("/home")):(console.log("Login Failed!"),g.loginError=!0,a(function(){g.loginError=!1},2e3))}var g=this;g.loginAttempt=f,g.loginError=!1,g.user=d.user,b.isLoggedOut=!c.isLoggedIn(),c.isLoggedIn()&&e.path("/home")}]),angular.module("gmitcat").service("detailsService",["$timeout","$rootScope",function(a,b){function c(){h.changes({since:"now",live:!0}).on("change",function(){e.getUsers()}),f.replicate.from(g,{live:!0}),e.getUsers()}function d(){h.allDocs({include_docs:!0,descending:!0},function(a,b){b.rows.forEach(function(a){"appDetails"===a.id?e.appDetails=a.doc:"loginDetails"===a.id&&(b.total_rows<1?(e.user.username="gmitcat",e.user.password="tactimg"):(e.user.username=a.doc.username,e.user.password=a.doc.password))},this)})["catch"](function(a){console.log("err: "+a)}),a(function(){b.$apply()})}var e=this,f=new PouchDB("details"),g=new PouchDB("https://tstandedineatheriessever:5cda967062d17119c43e89cdc61860b44da8c7c8@ronanconnolly.cloudant.com/gmitcat-details"),h=f;return e.appDetails={},e.user={},e.init=c,e.getUsers=d,e.init(),e}]),angular.module("gmitcat").service("userService",["$timeout","$rootScope",function(a,b){function c(){j.changes({since:"now",live:!0}).on("change",function(){g.getDetails()}),h.sync(i,{live:!0}).on("change",function(a){}).on("error",function(a){}),g.getDetails()}function d(){j.allDocs({include_docs:!0,descending:!0},function(a,b){g.users=[],b.rows.forEach(function(a){g.users.push(a.doc)},this),f(g.users)})["catch"](function(a){console.log("err: "+a)}),a(function(){b.$apply()})}function e(a){j.put(a)["catch"](function(a){console.log("err: "+a)}["catch"](function(a){console.log("err: "+JSON.stringify(a))})),f(g.users.users)}function f(a){g.deviceTokens=[],void 0!=a&&a.length>0&&a.forEach(function(a){g.deviceTokens.push(a.deviceToken)},this)}var g=this,h=new PouchDB("users"),i=new PouchDB("https://tstandedineatheriessever:5cda967062d17119c43e89cdc61860b44da8c7c8@ronanconnolly.cloudant.com/gmitcat-users"),j=h;return g.users=[],g.deviceTokens=[],g.init=c,g.getDetails=d,g.saveUser=e,g.init(),g}]),angular.module("gmitcat").service("messageService",["$timeout","$rootScope","$filter",function(a,b,c){function d(){k.changes({since:"now",live:!0}).on("change",function(){h.getDetails()}),i.sync(j,{live:!0}).on("change",function(a){}).on("error",function(a){}),h.getDetails()}function e(){k.allDocs({include_docs:!0,descending:!0},function(a,b){h.messages=[],b.rows.forEach(function(a){h.messages.push(a.doc)},this)}).then(function(a){})["catch"](function(a){console.log("err: "+a)}),a(function(){b.$apply()})}function f(a){k.put(a).then(function(a){})["catch"](function(a){console.log("err: "+a)})}function g(){return a(function(){b.$apply()}),h.messages}var h=this,i=new PouchDB("messages"),j=new PouchDB("https://tstandedineatheriessever:5cda967062d17119c43e89cdc61860b44da8c7c8@ronanconnolly.cloudant.com/gmitcat-messages"),k=i;return h.messages=[],h.init=d,h.getDetails=e,h.saveMessage=f,h.getMessages=g,h.init(),h}]),angular.module("gmitcat").run(["$templateCache",function(a){a.put("views/home.html",'<h1 class="jumbotron" id="magenta">Gmit Catering - Push Service</h1> <div class="container"> <!--<p>From here you can:</p>\n    <ul>\n        <li>Send push notificaions</li>\n    </ul>--> <button type="button" class="btn btn-primary btn-lg btn-block" ng-click="home.logout()">Log out</button> </div>'),a.put("views/login.html",'<h1 class="jumbotron" id="magenta">Login</h1> <div class="container"> <form name="loginForm" ng-submit="login.loginAttempt(user)"> <p id="error-message" ng-show="login.loginError" class="bg-danger">Incorrect username and/or password</p> <div class="form-group"> <label for="messageInput">Username</label> <input type="text" class="form-control" id="username" ng-model="user.username" ng-minlength="4" ng-maxlength="15" required> <label for="messageInput">Password</label> <input type="password" class="form-control" id="password" ng-model="user.password" ng-minlength="4" ng-maxlength="15" required> </div> <button type="submit" class="btn btn-primary" ng-disabled="!loginForm.$valid">Submit</button> <!--<p id="error-message" class="bg-danger">{{login.errorMsg}}</p>--> </form> </div>'),a.put("views/main.html",'<h1 class="jumbotron" id="magenta">Gmit Catering - Push Service</h1> <div class="container"> <p>From here you can:</p> <ul> <li>Send push notificaions</li> </ul> </div>'),a.put("views/notify.html",'<h1 class="jumbotron" id="magenta">Push Notifications</h1> <div class="container"> <!--http://getbootstrap.com/css/#forms--> <p id="primary-message" class="bg-primary">There are currently {{notify.userCount}} registered devices.</p> <p id="success-message" ng-show="notify.notifySuccess" class="bg-success">Push sent!</p> <p id="error-message" ng-show="notify.notifyError" class="bg-danger">Push error!</p> <p id="warning-message" ng-show="notify.notifyWarning" class="bg-warning">Push sending...</p> <form name="pushForm" ng-submit="notify.sendPush(push)"> <div class="form-group"> <label for="messageInput">Message</label> <input type="text" class="form-control" id="messageInput" placeholder="Enter message here" ng-model="push.message" ng-minlength="5" ng-maxlength="200" required> </div> <button type="submit" class="btn btn-primary" ng-disabled="!pushForm.$valid">Submit</button> </form> <br> <br> <table class="table table-striped"> <tr> <th>Time Sent</th> <th>Message</th> <th>Status</th> <!--<th>Message ID</th>--> </tr> <tr ng-repeat="message in notify.messages track by message.message_id"> <!--| orderBy : \'-timeStamp\' track by message.message_id">--> <!--track by message.message_id |--> <!--// track by notify.message_id  | orderBy : \'-timeStamp\'"--> <td>{{ message.timeStamp | date : \'medium\' }}</td> <!--EEE MMM dd yyyy hh:MM--> <td>{{ message.message }}</td> <td>{{ message.result }}</td> <!--<td>{{ message.message_id }}</td>--> </tr> </table> <!--<button ng-click="notify.debugLog()">debug</button>--> </div>')}]);